(()=>{"use strict";var e={990:(e,t,a)=>{a.r(t);var r=a(4636),n=a(3841),i=a(3923),o=a(5991),l=a(9649),s=a(733);const d=async e=>{try{await s.default.setItem("user",JSON.stringify(e))}catch(t){console.error("Error guardando el usuario:",t)}},c=async(e,t)=>{try{await s.default.setItem(e,t)}catch(a){console.error("Error guardando en storage:",a)}},u=async e=>{try{return await s.default.getItem(e)}catch(t){return console.error("Error obteniendo de storage:",t),null}},f=async e=>{try{await s.default.removeItem(e)}catch(t){console.error("Error eliminando de storage:",t)}},m=async e=>{try{await s.default.setItem("aulas",JSON.stringify(e))}catch(t){console.log("error al guardar materias",t)}},h=async()=>{try{const e=await s.default.getItem("aulas");return null!=e?JSON.parse(e):null}catch(e){return console.log("no hay aulas",e),null}};var g=a(8853);const x=(0,l.createContext)({user:null,setUser:()=>{},token:null,setToken:()=>{},logout:()=>{},loading:!0}),j=({children:e})=>{const[t,a]=(0,l.useState)(null),[r,n]=(0,l.useState)(!0),[i,o]=(0,l.useState)(null);(0,l.useEffect)((()=>{(async()=>{const e=await(async()=>{try{const e=await s.default.getItem("user");return null!==e?JSON.parse(e):null}catch(e){return console.error("Error obteniendo el usuario:",e),null}})(),t=await u("token");e&&a(e),t&&o(t),n(!1)})()}),[]);return(0,g.jsx)(x.Provider,{value:{user:t,setUser:a,loading:r,token:i,setToken:o,logout:async()=>{try{await f("token"),await f("user"),await f("aulas")}catch(e){console.log("error al borrar items",e)}a(null),o(null)}},children:e})},y=()=>(0,l.useContext)(x);var p=a(4147),b=a(3198),w=a(143),v=a(8363),S=a(5220),C=a(5830),T=a(9978),k=a(3997),B=a(4642);const A=({children:e})=>{const{colors:t}=(0,B.useTheme)();return(0,g.jsx)(k.LinearGradient,{colors:[t.primary,t.background],start:{x:.6,y:1},end:{x:.5,y:0},style:E.gradient,children:(0,g.jsx)(C.default,{style:E.safeArea,children:(0,g.jsx)(S.default,{style:E.flex,behavior:"height",keyboardVerticalOffset:T.default.currentHeight||0,children:(0,g.jsx)(v.default,{contentContainerStyle:E.scrollContainer,keyboardShouldPersistTaps:"handled",children:(0,g.jsx)(b.default,{style:E.innerContainer,children:e})})})})})},E=p.default.create({gradient:{flex:1},safeArea:{flex:1,paddingTop:0},flex:{flex:1},scrollContainer:{flexGrow:1},innerContainer:{flex:1,padding:16}}),D="https://adminaulas.onrender.com";const P=(0,l.createContext)(void 0),z=({children:e})=>{const{token:t,user:a}=y(),[r,n]=(0,l.useState)([]),[i,o]=(0,l.useState)({}),[d,c]=(0,l.useState)(!0),[f,x]=(0,l.useState)(null),[j,p]=(0,l.useState)(!1),b=async e=>{try{const t=await h();if(t)return n(t),void c(!1);const r=await async function(e){const t=await fetch(`${D}/aulas/mis-aulas`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(e),i=r.map((e=>Object.assign({},e,{alumnos:[a],alumnoIds:[a.id]})));n(i),await m(i)}catch(t){}},w=async e=>{try{const t=await h(),a=await(async()=>{try{const e=await s.default.getItem("alumnos");if(!e)return null;const t=JSON.parse(e),a={};return t.forEach((e=>{a[e.id]=e})),a}catch(e){return console.error("Error al leer alumnos desde storage:",e),null}})();if(t&&a)return n(t),o(a),void c(!1);const r=await async function(e){const t=await fetch(`${D}/aulas/mis-aulas-con-alumnos`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(e),i={},l=r.map((e=>(e.alumnos.forEach((e=>{i[e.id]=e})),{id:e.id,nombre:e.nombre,ano:e.ano,division:e.division,especialidad:e.especialidad,profesor_id:e.profesor_id,cantidad_clases:e.cantidad_clases,alumnoIds:e.alumnos.map((e=>e.id))})));n(l),o(i),await m(l),await(async e=>{try{const t=JSON.stringify(e);await s.default.setItem("alumnos",t)}catch(t){console.error("Error al guardar alumnos:",t)}})(Object.values(i))}catch(t){console.error("Error cargando datos desde appData:",t)}finally{c(!1)}},v=async e=>{const r=e||t;r&&(a?.is_teacher?await w(r):await b(r))};return(0,l.useEffect)((()=>{v()}),[t]),(0,g.jsx)(P.Provider,{value:{aulas:r,alumnosMap:i,isLoading:d,loadData:v,alarcoins:f,loadAlarcoins:async()=>{let e=t;t||(e=await u("token")),p(!1);try{let t;a?.is_teacher?(t=await async function(e){const t=await fetch(`${D}/alarcoins/historial`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al obtener historial")}return await t.json()}(e),(async e=>{(e=>{const t=Object.assign({},i);Object.keys(t).forEach((e=>{t[+e]=Object.assign({},t[+e],{alarcoin:0})})),e.forEach((e=>{e.alumnos.forEach((e=>{const a=(e=>e.reduce(((e,t)=>e+(t.suma?t.cantidad:-t.cantidad)),0))(e?.alarcoins);t[e.id]&&(t[e.id].alarcoin=(t[e.id].alarcoin||0)+a)}))})),o(t)})(e),x(e)})(t)):(t=await async function(e){const t=await fetch(`${D}/alarcoins/me`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al obtener mis alarcoins")}return await t.json()}(e),(async e=>{x(e)})(t))}catch(r){console.error("Error cargando alarcoins:",r),p(!0)}},alarcoinsError:j},children:e})},I=()=>{const e=(0,l.useContext)(P);if(!e)throw new Error("useAppData debe usarse dentro de AppDataProvider");return e};var M=a(6437),_=a(8082);const O="#b14aca";var R=a(2317),L=a(2969),W=a(8810);const $=({title:e,value:t,icon:a,color:r="#6200ee"})=>(0,g.jsx)(R.default,{style:N.card,mode:"contained",children:(0,g.jsxs)(R.default.Content,{style:N.cardContent,children:[(0,g.jsx)(L.default,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:a,color:e,size:t}),style:{backgroundColor:r}}),(0,g.jsxs)(b.default,{style:{marginLeft:12},children:[(0,g.jsx)(_.default,{variant:"labelLarge",style:{color:"#777"},children:e}),(0,g.jsx)(_.default,{variant:"titleMedium",style:{fontWeight:"bold"},children:t})]})]})}),N=p.default.create({card:{width:"100%",maxWidth:600,minWidth:350,marginBottom:12,elevation:12,borderRadius:12,alignSelf:"center"},cardContent:{flexDirection:"row",alignItems:"center"}});var F=a(223),V=a(9812),G=a(2030),H=a(3231),q=a(9454),J=a(2520);const U=({alumnos:e})=>(0,g.jsx)(R.default,{style:Z.card,children:(0,g.jsx)(F.default,{title:`Alumnos (${e.length})`,left:e=>(0,g.jsx)(V.default,Object.assign({},e,{icon:({size:e,color:t})=>(0,g.jsx)(J.default,{name:"account-group-outline",size:e,color:t})})),right:e=>(0,g.jsx)(J.default,{name:e.isExpanded?"chevron-up":"chevron-down",size:24,color:"#fff"}),titleStyle:Z.accordionTitle,style:Z.accordion,children:0===e.length?(0,g.jsx)(G.default,{title:"No hay alumnos",left:e=>(0,g.jsx)(V.default,Object.assign({},e,{icon:({size:e,color:t})=>(0,g.jsx)(J.default,{name:"alert-circle-outline",size:e,color:t})})),titleStyle:{color:"#888"}}):e.map(((t,a)=>(0,g.jsxs)(b.default,{children:[(0,g.jsx)(G.default,{title:t.nombre,description:t.email,left:()=>(0,g.jsx)(H.default,{size:36,label:t.nombre?t.nombre[0].toUpperCase():"A",style:Z.avatar,color:"#fff"}),titleStyle:Z.itemTitle,descriptionStyle:Z.itemDescription,style:Z.listItem}),a<e.length-1&&(0,g.jsx)(q.default,{})]},t.id)))})}),Z=p.default.create({card:{width:"100%",maxWidth:600,marginBottom:12,elevation:12,borderRadius:16,overflow:"hidden"},accordion:{},accordionTitle:{color:"#fff",fontWeight:"bold",fontSize:18},listItem:{backgroundColor:"#fff",paddingVertical:6,paddingHorizontal:8},itemTitle:{color:"#C93A4A",fontWeight:"600",fontSize:16},itemDescription:{color:"#888",fontSize:13},avatar:{backgroundColor:"#C93A4A",marginRight:8}}),K=()=>{const{width:e}=(0,w.default)(),t=e<400,{user:a,loading:r}=y(),{aulas:n,alumnosMap:i,isLoading:o,alarcoins:l}=I(),s=o&&r,d=n.reduce(((e,t)=>e+(t.cantidad_clases||0)),0),{saludo:c,fecha:u}=(()=>{const e=new Date,t=e.getHours();let a;return a=t>=6&&t<12?"Buenos d\xedas":t>=12&&t<19?"Buenas tardes":"Buenas noches",{saludo:a,fecha:e.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}})();return(0,g.jsx)(A,{children:s?(0,g.jsx)(M.default,{size:"large",color:O}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(b.default,{style:[Q.header,t&&Q.headerSmall],children:[(0,g.jsxs)(b.default,{children:[(0,g.jsx)(_.default,{variant:"titleMedium",children:`${c}, ${a?.nombre}`}),(0,g.jsx)(_.default,{variant:"labelMedium",children:a?.is_teacher?"Profesor":"Alumno"})]}),(0,g.jsx)(b.default,{style:t&&{marginTop:8},children:(0,g.jsx)(_.default,{variant:"bodySmall",children:u})})]}),(0,g.jsxs)(b.default,{style:Q.cardsContainer,children:[(0,g.jsx)($,{title:"Aulas",value:n.length,icon:"school",color:O}),(0,g.jsx)($,{title:"Clases",value:d,icon:"calendar",color:"#C93A9F"}),a?.is_teacher&&(0,g.jsx)(U,{alumnos:Object.values(i)})]})]})})},Q=p.default.create({header:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,gap:10},headerSmall:{flexDirection:"column",alignItems:"flex-start",gap:4},cardsContainer:{flexWrap:"wrap",alignContent:"center",justifyContent:"space-between",gap:16,marginBottom:24},alumnosListContainer:{marginTop:16}});var X=a(552),Y=a(500),ee=a(7799),te=a(8488),ae=a(1561);var re=a(397);const ne=ae.object().shape({email:ae.string().email("Email inv\xe1lido").required("Requerido"),password:ae.string().min(6,"M\xednimo 6 caracteres").required("Requerido")});function ie(){const e=(0,n.useNavigation)(),{loading:t,setUser:a,setToken:r}=y(),{loadData:i}=I(),o=async(t,n,o,l)=>{try{const n=await async function(e){const t=await fetch(`${D}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(t);l(),a(n.user),r(n.access_token),await d(n.user),await c("token",n.access_token),i(n.access_token),e.navigate("Main")}catch(s){o("Credenciales inv\xe1lidas")}finally{n(!1)}};return(0,g.jsx)(A,{children:t?(0,g.jsx)(X.default,{children:"Cargando ..."}):(0,g.jsx)(b.default,{style:oe.container,children:(0,g.jsxs)(b.default,{style:oe.card,children:[(0,g.jsx)(X.default,{style:oe.title,children:"Iniciar sesi\xf3n"}),(0,g.jsx)(te.Formik,{initialValues:{email:"",password:""},validationSchema:ne,onSubmit:(e,{setSubmitting:t,setErrors:a,resetForm:r})=>o(e,t,(e=>a({password:e})),r),children:({handleChange:e,handleBlur:t,handleSubmit:a,values:r,errors:n,touched:i,isSubmitting:o})=>(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Y.default,{style:oe.input,placeholder:"Email",onChangeText:e("email"),onBlur:t("email"),value:r.email,keyboardType:"email-address",autoCapitalize:"none"}),i.email&&n.email&&(0,g.jsx)(X.default,{style:oe.error,children:n.email}),(0,g.jsx)(Y.default,{style:oe.input,placeholder:"Contrase\xf1a",onChangeText:e("password"),onBlur:t("password"),value:r.password,secureTextEntry:!0}),i.password&&n.password&&(0,g.jsx)(X.default,{style:oe.error,children:n.password}),(0,g.jsx)(re.default,{onPress:a,children:o?(0,g.jsx)(ee.default,{color:"#fff"}):(0,g.jsx)(X.default,{style:oe.buttonText,children:"Ingresar"})})]})})]})})})}const oe=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},card:{width:"85%",padding:24,borderRadius:12,backgroundColor:"#fefefe80",elevation:6,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:5,maxWidth:400},title:{fontSize:22,fontWeight:"bold",marginBottom:16,textAlign:"center"},input:{height:48,borderColor:"#ccc",borderWidth:1,borderRadius:8,paddingHorizontal:12,marginTop:12,backgroundColor:"#fff"},error:{color:"red",fontSize:12,marginTop:4,marginLeft:4},button:{backgroundColor:"#007AFF",paddingVertical:12,borderRadius:8,marginTop:20,alignItems:"center"},buttonText:{color:"#fff",fontWeight:"600",fontSize:16}});var le=a(9343),se=a(4423);const de=ae.object({name:ae.string().required("El nombre es obligatorio"),email:ae.string().email("Correo inv\xe1lido").required("El correo es obligatorio"),currentPassword:ae.string().required("Campo obligatorio"),newPassword:ae.string().min(6,"Debe tener al menos 6 caracteres")}),ce=p.default.create({container:{flexGrow:1,padding:15,alignItems:"center",minHeight:"100%"},header:{fontWeight:"bold",fontSize:28,marginTop:16,marginBottom:4,alignSelf:"flex-start",letterSpacing:.5},subheader:{marginBottom:16,alignSelf:"flex-start",fontSize:16,opacity:.85},avatarContainer:{alignItems:"center",marginVertical:16,width:"100%"},cardheader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingRight:8,paddingTop:8},cardTitle:{fontSize:20,fontWeight:"bold"},cardSubtitle:{fontSize:14},editButton:{marginTop:16,borderRadius:20,minWidth:120,elevation:0,alignSelf:"center"},card:{width:"100%",maxWidth:500,alignSelf:"center",marginTop:16,paddingHorizontal:0,borderRadius:16,elevation:2},form:{gap:8,marginTop:8,width:"100%"},input:{marginBottom:4},error:{fontSize:12,marginBottom:4,marginLeft:4},buttonGroup:{marginTop:16,flexDirection:"row",justifyContent:"flex-end",gap:8},saveButton:{marginLeft:8,borderRadius:20,minWidth:100},cancelButton:{borderColor:"#ccc",borderRadius:20,minWidth:100},logoutButton:{marginTop:32,width:"100%",maxWidth:500,alignSelf:"center",borderRadius:20,borderWidth:1,borderColor:"#e53935",color:"#e53935"}}),ue=()=>{const{user:e}=y(),[t,a]=(0,l.useState)(!1),[r,n]=(0,l.useState)(e?.nombre),[i,o]=(0,l.useState)(e?.apellido),[s]=(0,l.useState)(e?.email),{colors:d}=(0,B.useTheme)(),{width:c}=(0,w.default)(),[u,f]=(0,l.useState)(""),[m,h]=(0,l.useState)(""),x=()=>a(!0),j=()=>{a(!1),f(""),h("")};return(0,g.jsx)(A,{children:(0,g.jsxs)(v.default,{contentContainerStyle:[ce.container,,],children:[(0,g.jsx)(_.default,{variant:"titleLarge",style:[ce.header,{color:d.primary}],children:"Perfil"}),(0,g.jsx)(_.default,{variant:"bodyMedium",style:[ce.subheader,{color:d.onSurfaceVariant}],children:"Administra tu informaci\xf3n personal"}),(0,g.jsxs)(R.default,{style:[ce.card,{backgroundColor:d.surface}],children:[(0,g.jsx)(b.default,{style:ce.cardheader,children:(0,g.jsx)(R.default.Title,{title:"Informaci\xf3n Personal",subtitle:"Actualiza tu informaci\xf3n de cuenta",titleStyle:[ce.cardTitle,{color:d.primary}],subtitleStyle:[ce.cardSubtitle,{color:d.onSurfaceVariant}]})}),(0,g.jsx)(q.default,{style:{marginBottom:8,backgroundColor:d.outlineVariant}}),(0,g.jsx)(R.default.Content,{children:(0,g.jsx)(te.Formik,{initialValues:{name:r||"",apellido:i||"",email:s||"",newPassword:"",confirmPassword:""},validationSchema:de,onSubmit:e=>{u&&u!==m?le.default.alert("Error","Las contrase\xf1as no coinciden."):a(!1)},enableReinitialize:!0,children:({handleChange:e,handleBlur:a,handleSubmit:l,values:y,errors:p,touched:w})=>(0,g.jsxs)(b.default,{style:ce.form,children:[(0,g.jsx)(se.default,{label:"Nombre",value:r,onChangeText:n,editable:t,mode:"flat",style:[ce.input,{backgroundColor:t?d.background:d.surfaceDisabled}],error:!!p.name&&w.name,onBlur:a("name"),left:(0,g.jsx)(se.default.Icon,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:"person-outline",color:e,size:t})})}),t&&p.name&&w.name&&(0,g.jsx)(_.default,{style:[ce.error,{color:d.error}],children:p.name}),(0,g.jsx)(se.default,{label:"Apellido",value:i,onChangeText:o,editable:t,mode:"flat",style:[ce.input,{backgroundColor:t?d.background:d.surfaceDisabled}],error:!!p.apellido&&w.apellido,onBlur:a("apellido"),left:(0,g.jsx)(se.default.Icon,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:"person-outline",color:e,size:t})})}),t&&p.apellido&&w.apellido&&(0,g.jsx)(_.default,{style:[ce.error,{color:d.error}],children:p.apellido}),(0,g.jsx)(se.default,{label:"Email",value:s,editable:!1,mode:"flat",style:[ce.input,{backgroundColor:d.surfaceDisabled}],left:(0,g.jsx)(se.default.Icon,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:"mail-outline",color:e,size:t})})}),t&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(se.default,{label:"Nueva clave",secureTextEntry:!0,textContentType:"oneTimeCode",value:u,onChangeText:f,placeholder:"********",mode:"flat",style:[ce.input,{backgroundColor:d.background}],error:!!p.newPassword&&w.newPassword,onBlur:a("newPassword"),left:(0,g.jsx)(se.default.Icon,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:"lock-closed-outline",color:e,size:t})})}),p.newPassword&&w.newPassword&&(0,g.jsx)(_.default,{style:[ce.error,{color:d.error}],children:p.newPassword}),(0,g.jsx)(se.default,{label:"Repetir clave",secureTextEntry:!0,value:m,onChangeText:h,placeholder:"********",mode:"flat",style:[ce.input,,],left:(0,g.jsx)(se.default.Icon,{icon:({color:e,size:t})=>(0,g.jsx)(W.default,{name:"lock-closed-outline",color:e,size:t})})}),(0,g.jsxs)(b.default,{style:ce.buttonGroup,children:[(0,g.jsx)(re.default,{mode:"outlined",style:[ce.cancelButton,{borderColor:d.outline},c<400&&{flex:1}],onPress:j,labelStyle:{color:d.primary},children:"Cancelar"}),(0,g.jsx)(re.default,{mode:"contained",style:[ce.saveButton,{backgroundColor:d.primary},c<400&&{flex:1}],onPress:l,labelStyle:{color:d.onPrimary},children:"Guardar"})]})]}),!t&&(0,g.jsx)(re.default,{style:[ce.editButton,{backgroundColor:d.primary},c<400&&{width:"100%",alignSelf:"center"}],mode:"contained",icon:"pencil",onPress:x,labelStyle:{color:d.onPrimary,fontSize:16},contentStyle:{paddingVertical:8},children:"Editar"})]})})})]})]})})};var fe=a(3124),me=a(193),he=a(2773),ge=a(2149);const xe=(e,t)=>`${e?.trim()?.[0]?.toUpperCase()??""}${t?.trim()?.[0]?.toUpperCase()??""}`,je=p.default.create({profile:{alignItems:"center",marginBottom:16,maxWidth:350,margin:10,width:"100%"},avatar:{backgroundColor:"#c001f5"},name:{marginTop:8,fontWeight:"bold"},role:{fontSize:14,color:"#6b7280"}}),ye=({alarcoins:e,isalarcoins:t=!1,user:a,loading:r})=>{const{colors:i}=(0,n.useTheme)();return(0,g.jsxs)(b.default,{style:[je.profile,t&&{backgroundColor:i.background,borderRadius:12,padding:16,elevation:2,shadowColor:"#000",shadowOffset:{width:0,height:1},shadowOpacity:.2,shadowRadius:1.41}],children:[(0,g.jsx)(H.default,{label:xe(a?.nombre,a?.apellido),size:64,style:je.avatar}),(0,g.jsx)(_.default,{variant:"titleLarge",style:je.name,children:r?"Cargando":`${a?.nombre} ${a?.apellido}`}),!t&&(0,g.jsx)(_.default,{variant:"bodySmall",style:je.role,children:r?"cargando":a?.is_teacher?"Profesor":"Alumno"}),t&&(0,g.jsxs)(b.default,{children:[(0,g.jsx)(_.default,{variant:"bodyMedium",children:"Tus Alarcoins"}),(0,g.jsx)(_.default,{variant:"bodyMedium",style:{textAlign:"center"},children:e})]})]})};var pe=a(6573),be=a(4821),we=a(995);const ve=Object.assign({},be.MD3LightTheme,{colors:Object.assign({},be.MD3LightTheme.colors,{primary:"#d83dff",background:"#d1a3ff",surface:"#d1a3ff",text:"#2b2b2b",secondary:"#4ab19f",accent:"#f2c94c",asistenciaBuena:"#10b981",asistenciaMedia:"#ffb93f",asistenciaMala:"#ef4444"})}),Se=Object.assign({},we.MD3DarkTheme,{colors:Object.assign({},we.MD3DarkTheme.colors,{primary:"#b14aca",background:"#302f2f",surface:"#1e1e1e",text:"#ffffff",secondary:"#4ab19f",accent:"#f2c94c",asistenciaBuena:"#097551",asistenciaMedia:"#f59e0b",asistenciaMala:"#e21313"})});var Ce=a(2162);const Te=(0,l.createContext)({isDarkMode:!1,toggleTheme:()=>{},theme:ve}),ke=({children:e})=>{const t=(0,Ce.default)(),[a,r]=(0,l.useState)(!0),[n,i]=(0,l.useState)("dark"===t);(0,l.useEffect)((()=>{(async()=>{const e=await u("theme");"light"===e||"dark"===e?(r(!1),i("dark"===e)):(r(!0),i("dark"===t))})()}),[]),(0,l.useEffect)((()=>{a&&t&&i("dark"===t)}),[t,a]),(0,l.useEffect)((()=>{const e=pe.default.addChangeListener((({colorScheme:e})=>{i("dark"===e)}));return()=>e.remove()}),[]);const o=n?Se:ve;return(0,g.jsx)(Te.Provider,{value:{isDarkMode:n,toggleTheme:async()=>{const e=!n;i(e),r(!1),await c("theme",e?"dark":"light")},theme:o},children:e})},Be=()=>(0,l.useContext)(Te);function Ae(e){const{isDarkMode:t,toggleTheme:a}=Be(),{user:r,loading:i,logout:l}=y(),s=[{icon:"grid-outline",label:"Dashboard",screen:"Home"},{icon:"person-outline",label:"Perfil",screen:"Perfil"},{icon:"book-outline",label:"Mis Aulas",screen:"MateriasStack"},{icon:"logo-bitcoin",label:r?r.is_teacher?"Alarcoins":"Mis Alarcoins":"Alarcoins",screen:"Alarcoin"}],d=(0,n.useNavigation)();return(0,g.jsx)(o.DrawerContentScrollView,Object.assign({},e,{contentContainerStyle:{flex:1},children:(0,g.jsxs)(b.default,{style:Ee.container,children:[(0,g.jsx)(ye,{user:r,loading:i,isalarcoins:!1}),(0,g.jsx)(me.default,{style:Ee.nav,children:s.map(((t,a)=>(0,g.jsx)(o.DrawerItem,{icon:({color:e,size:a})=>(0,g.jsx)(W.default,{name:t.icon,color:e,size:a}),label:t.label,onPress:()=>e.navigation.navigate(t.screen)},a)))}),(0,g.jsxs)(me.default,{style:Ee.bottom,children:[(0,g.jsx)(o.DrawerItem,{icon:({color:e,size:a})=>(0,g.jsx)(W.default,{name:t?"moon":"sunny",color:e,size:a}),label:t?"Modo oscuro":"Modo claro",onPress:a,style:Ee.themeItem,right:()=>(0,g.jsx)(he.default,{value:t,onValueChange:a})}),(0,g.jsx)(o.DrawerItem,{icon:({color:e,size:t})=>(0,g.jsx)(ge.default,{name:"log-out",color:e,size:t}),label:"Cerrar sesi\xf3n",onPress:()=>{l(),d.dispatch(n.CommonActions.reset({index:0,routes:[{name:"Login"}]}))}})]})]})}))}const Ee=p.default.create({container:{flex:1,paddingTop:24},nav:{marginTop:16},bottom:{marginTop:"auto",padding:5},switchRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:8},themeItem:{paddingRight:8}});var De=a(8112),Pe=a(2511),ze=a(2061),Ie=a(5933),Me=a(6375),_e=a(3479),Oe=a(5315);const Re=({historial:e,onSeleccionar:t,error:a})=>{const[r,n]=(0,l.useState)(!1),[i,o]=(0,l.useState)({label:"Elegir materia",id:null}),s=()=>n(!1),d=(e,a)=>{o({label:e,id:a}),s(),t(a)};return(0,l.useEffect)((()=>{o({label:"Elegir materia",id:0})}),[e]),(0,g.jsxs)(b.default,{children:[(0,g.jsxs)(_e.default,{visible:r,onDismiss:s,anchor:(0,g.jsx)(re.default,{mode:a?"contained-tonal":"outlined",onPress:()=>n(!0),icon:"chevron-down",contentStyle:{flexDirection:"row-reverse",justifyContent:"space-between"},style:{borderColor:a?"#B00020":void 0},children:i.label}),children:[(0,g.jsx)(_e.default.Item,{onPress:()=>d("Elegir materia",null),title:"Elegir materia"},"default-item"),(0,g.jsx)(q.default,{}),e.map((e=>(0,g.jsx)(_e.default.Item,{onPress:()=>d(e.nombre,e.aula_id),title:e.nombre},e.aula_id)))]}),a&&(0,g.jsx)(Oe.default,{type:"error",visible:a,children:"Debes seleccionar una materia."})]})},Le=({visible:e,onDismiss:t,user:a,is_teacher:r,selectedAula:n})=>{if(!a)return null;const{colors:i}=(0,B.useTheme)(),[o,s]=(0,l.useState)(r?"asignar":"historial"),[d,c]=(0,l.useState)("0"),[u,f]=(0,l.useState)(""),[m,h]=(0,l.useState)("1"),[x,j]=(0,l.useState)(null),[p,w]=(0,l.useState)(!1),[S,C]=(0,l.useState)(""),{alarcoins:T,loadAlarcoins:k}=I(),{token:A}=y(),[E,P]=(0,l.useState)(!1),z=(0,l.useMemo)((()=>a?r?T.map((e=>{const t=e.alumnos.find((e=>e.id===a.id));return t?{aula_id:e.aula_id,nombre:e.nombre,alarcoins:t.alarcoins||[]}:null})).filter((e=>null!==e)):n?[{aula_id:n.id,nombre:n.nombre,alarcoins:n.alarcoins}]:[]:[]),[T,a,r,n]);return(0,g.jsxs)(De.default,{children:[(0,g.jsx)(Pe.default,{visible:p&&""!==S,duration:1e3,onDismiss:()=>{w(!1),C("")},action:{label:"Dale",onPress:()=>w(!1)},children:S}),(0,g.jsxs)(ze.default,{visible:e,onDismiss:t,contentContainerStyle:{backgroundColor:i.surface,padding:10,margin:10,borderRadius:12,width:"90%",maxWidth:500,justifyContent:"flex-start",alignSelf:"center"},children:[(0,g.jsx)(b.default,{style:{flexDirection:"row",justifyContent:"center",alignItems:"center",width:"100%",flexWrap:"nowrap",overflow:"hidden",marginBottom:8},children:(0,g.jsx)(Ie.default,{value:o,onValueChange:s,buttons:[{value:"historial",label:"Historial"},...r?[{value:"asignar",label:"Asignar"}]:[]],style:{flex:1,minWidth:0,maxWidth:"100%",borderRadius:12,overflow:"hidden"},contentStyle:{flexDirection:"row",flexWrap:"nowrap",minWidth:0,maxWidth:"100%"}})}),"asignar"===o&&r&&(0,g.jsxs)(R.default,{mode:"contained",style:{marginTop:10,padding:5},children:[(0,g.jsx)(_.default,{variant:"titleMedium",style:{marginBottom:5},children:`Gestionar Alarcoins de: ${a.nombre} ${a.apellido}`}),(0,g.jsx)(Re,{historial:z,onSeleccionar:j}),(0,g.jsx)(q.default,{style:{marginVertical:16}}),(0,g.jsx)(_.default,{variant:"labelLarge",style:{marginBottom:4},children:"Cantidad"}),(0,g.jsxs)(b.default,{style:{flexDirection:"row",alignItems:"center",gap:8},children:[(0,g.jsx)(re.default,{mode:"outlined",onPress:()=>c((e=>String(Math.max(0,Number(e)-1)))),children:"-"}),(0,g.jsx)(se.default,{value:d,onChangeText:c,keyboardType:"numeric",mode:"outlined",style:{flex:1}}),(0,g.jsx)(re.default,{mode:"outlined",onPress:()=>c((e=>String(Number(e)+1))),children:"+"})]}),(0,g.jsx)(se.default,{label:"Concepto",mode:"outlined",value:u,onChangeText:f,style:{marginTop:16}}),(0,g.jsx)(_.default,{variant:"labelLarge",style:{marginTop:16},children:"Tipo de operaci\xf3n"}),(0,g.jsx)(Me.default.Group,{onValueChange:e=>h(e),value:m,children:(0,g.jsxs)(b.default,{style:{flexDirection:"row",justifyContent:"flex-end"},children:[(0,g.jsx)(Me.default.Item,{label:"Sumar",value:"1"}),(0,g.jsx)(Me.default.Item,{label:"Restar",value:"0"})]})}),(0,g.jsx)(q.default,{style:{marginVertical:16}}),(0,g.jsx)(b.default,{style:{flexDirection:"row",justifyContent:"flex-end"},children:(0,g.jsx)(re.default,{mode:"contained",onPress:async()=>{if(!x||0===x)return C("Debes seleccionar una materia v\xe1lida."),void w(!0);if(!u.trim())return void le.default.alert("Atenci\xf3n","Debes ingresar un concepto.");P(!0);const e={aula_id:x,alumno_id:a.id,detalle:u,suma:Number(m),cantidad:Number(d)};try{await async function(e,t){const a=await fetch(`${D}/alarcoins/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(t)});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al asignar alarcoin")}return await a.json()}(A,e),c("0"),f(""),h("true"),j(null),t(),k(),C("Alarcoin guardado correctamente."),w(!0)}catch(r){C("error al guardar"),w(!0)}finally{P(!1)}},children:E?"Guardando...":"Guardar"})})]}),"historial"===o&&(0,g.jsxs)(b.default,{style:{marginTop:12},children:[(0,g.jsx)(_.default,{variant:"titleMedium",style:{marginBottom:8},children:"Historial de Alarcoins"}),z.every((e=>0===e.alarcoins.length))?(0,g.jsx)(_.default,{style:{marginTop:8},children:"No hay historial a\xfan"}):(0,g.jsx)(v.default,{children:z.filter((e=>e.alarcoins.length>0)).map((e=>{const t=e.alarcoins.reduce(((e,t)=>e+(t.suma>0?t.cantidad:-t.cantidad)),0);return(0,g.jsxs)(R.default,{style:{marginBottom:16},children:[(0,g.jsx)(R.default.Title,{title:(0,g.jsxs)(b.default,{style:{flexDirection:"row",alignItems:"center"},children:[(0,g.jsx)(_.default,{children:e.nombre}),(0,g.jsx)(_.default,{style:{marginLeft:8,fontWeight:"bold",color:t>=0?"green":"red"},children:`(${t})`})]})}),(0,g.jsx)(R.default.Content,{children:e.alarcoins.map(((e,t)=>(0,g.jsxs)(b.default,{children:[(0,g.jsxs)(b.default,{style:{flexDirection:"row",justifyContent:"space-between",marginVertical:4},children:[(0,g.jsx)(_.default,{children:new Date(e.fecha).toLocaleDateString()}),(0,g.jsx)(_.default,{children:e.detalle}),(0,g.jsx)(_.default,{style:{color:e.suma>0?"green":"red"},children:e.suma>0?`+${e.cantidad}`:`-${e.cantidad}`})]}),(0,g.jsx)(q.default,{})]},t)))})]},e.aula_id)}))})]})]})]})};var We=a(4250);function $e({isLoading:e,hasError:t,reLoad:r,children:n,errorMessage:i="Ocurri\xf3 un error al cargar los datos"}){return e?(0,g.jsx)(b.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:(0,g.jsx)(M.default,{size:"large",color:"violet"})}):t?(0,g.jsxs)(b.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:[(0,g.jsx)(_.default,{variant:"titleLarge",style:{marginBottom:12,color:"#9333EA",textAlign:"center"},children:i}),(0,g.jsx)(We.default,{source:a(2058),style:{width:200,height:200,marginBottom:20,borderRadius:100},resizeMode:"contain"}),(0,g.jsx)(re.default,{mode:"contained",onPress:r,children:"Reintentar"})]}):(0,g.jsx)(g.Fragment,{children:n})}function Ne({materia:e,onPress:t,porcentaje:a=0,is_alumno:r,alarcoin:n}){const{colors:i}=(0,B.useTheme)();return(0,g.jsx)(R.default,{style:[Fe.card],mode:"outlined",onPress:t?()=>t(e):void 0,children:(0,g.jsx)(k.LinearGradient,{colors:r&&!n?(e=>0===e?["transparent","transparent"]:e<60?[i.background,i.asistenciaMala]:e<79?[i.background,i.asistenciaMedia]:[i.background,i.asistenciaBuena])(a):["#trnasparent","transparent"],start:{x:.4,y:.3},end:{x:1,y:1},style:{borderRadius:8,padding:10},children:(0,g.jsxs)(R.default.Content,{style:Fe.cardContent,children:[(0,g.jsxs)(b.default,{style:Fe.infoLeft,children:[(0,g.jsx)(_.default,{variant:"titleMedium",children:e.nombre}),(0,g.jsx)(b.default,{style:Fe.scheduleRow,children:(0,g.jsx)(_.default,{variant:"bodySmall",children:`${e.ano}\xb0 ${e.division}\xb0 - ${e.especialidad}`})})]}),(0,g.jsxs)(b.default,{style:Fe.infoRight,children:[(0,g.jsx)(_.default,{variant:"labelSmall",children:r&&null==n?"Asistencias":null!=n?"Alarcoins":" Clases dictadas"}),(0,g.jsx)(_.default,{variant:"titleMedium",style:Fe.classCount,children:r&&null==n?`${a}%`:null!=n?n:e.cantidad_clases})]})]})})})}const Fe=p.default.create({card:{marginBottom:16,width:"100%",marginHorizontal:10,maxWidth:450,borderRadius:8,elevation:3,alignSelf:"center"},cardContent:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},infoLeft:{flex:1,gap:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},infoRight:{alignItems:"flex-end"},classCount:{marginTop:2,fontWeight:"600"}}),Ve=()=>{const{user:e}=y(),{alumnosMap:t,loadAlarcoins:a,alarcoins:r,alarcoinsError:n,aulas:i}=I(),[o,s]=(0,l.useState)(null),[d,c]=(0,l.useState)(),[u,f]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!0),{width:x}=(0,w.default)(),j=()=>{r||(h(!0),a()),h(!1)};(0,l.useEffect)((()=>{j()}),[]);const p=x>=1e3?3:x>=600?2:1,S=({item:t})=>{e?.is_teacher?s(t):(s(e),c(t)),f(!0)},C=t=>{if(e?.is_teacher)return(0,g.jsx)(fe.default,{style:({pressed:e})=>[{flex:1,opacity:e?.5:1}],onPress:()=>S({item:t}),children:(0,g.jsx)(ye,{user:t,loading:!1,isalarcoins:!0,alarcoins:t.alarcoin})},t.id);{const e=i.find((e=>e.id===t.aula_id));if(!e)return null;const a=t.alarcoins.reduce(((e,t)=>e+(t.suma?t.cantidad:-t.cantidad)),0);return(0,g.jsx)(fe.default,{style:({pressed:e})=>[{flex:1,opacity:e?.5:1}],onPress:()=>S({item:t}),children:(0,g.jsx)(Ne,{materia:e,is_alumno:!0,alarcoin:a})},t.aula_id)}},T=e?.is_teacher?Object.values(t):r??[],k=[];for(let l=0;l<T.length;l+=p)k.push(T.slice(l,l+p));return(0,g.jsx)(A,{children:(0,g.jsxs)($e,{isLoading:m,hasError:n,errorMessage:"Error al cargar los Alarcoins",reLoad:j,children:[(0,g.jsx)(v.default,{contentContainerStyle:{paddingBottom:32,gap:12,paddingHorizontal:10,marginHorizontal:5},children:k.map(((t,a)=>(0,g.jsxs)(b.default,{style:{flexDirection:"row",justifyContent:p>1?"center":"flex-start",marginBottom:12,gap:12},children:[t.map((t=>(0,g.jsx)(b.default,{style:{flex:1},children:C(t)},e?.is_teacher?t.id:t.aula_id))),t.length<p&&Array.from({length:p-t.length}).map(((e,t)=>(0,g.jsx)(b.default,{style:{flex:1}},`empty-${t}`)))]},a)))}),(0,g.jsx)(Le,{visible:u,onDismiss:()=>{f(!1)},user:o,is_teacher:e?.is_teacher,selectedAula:d})]})})};const Ge=()=>{const{user:e,setUser:t,token:a}=y(),r=(0,n.useNavigation)(),[i,o]=(0,l.useState)(!1),[s,c]=(0,l.useState)(null),[f,m]=(0,l.useState)(a);(0,l.useEffect)((()=>{if(f)return;const e=u("token");m(e)}));const h=ae.object().shape({newPassword:ae.string().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/[A-Z]/,"La contrase\xf1a debe contener al menos una letra may\xfascula").required("Campo obligatorio"),confirmPassword:ae.string().oneOf([ae.ref("newPassword")],"Las contrase\xf1as no coinciden").required("Campo obligatorio")});return(0,g.jsx)(A,{children:(0,g.jsx)(b.default,{style:He.container,children:(0,g.jsxs)(R.default,{style:He.card,children:[(0,g.jsx)(R.default.Title,{title:"Cambia tu contrase\xf1a",subtitle:"Por seguridad, debes actualizarla"}),(0,g.jsx)(R.default.Content,{children:(0,g.jsx)(te.Formik,{initialValues:{newPassword:"",confirmPassword:""},validationSchema:h,onSubmit:async e=>{o(!0),c(null);try{const n=await async function(e,t){const a=await fetch(`${D}/users/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al actualizar el usuario")}return await a.json()}({password:e.newPassword,cambiarContrasena:!1},a);t(Object.assign({},n)),await d(n),r.navigate("Main")}catch(n){c(n.message||"Error al cambiar la contrase\xf1a")}finally{o(!1)}},children:({handleChange:e,handleBlur:t,handleSubmit:a,values:r,errors:n,touched:o})=>(0,g.jsxs)(b.default,{children:[(0,g.jsx)(se.default,{label:"Nueva contrase\xf1a",secureTextEntry:!0,value:r.newPassword,onChangeText:e("newPassword"),onBlur:t("newPassword"),style:He.input}),o.newPassword&&n.newPassword&&(0,g.jsx)(_.default,{style:He.error,children:n.newPassword}),(0,g.jsx)(se.default,{label:"Repetir contrase\xf1a",secureTextEntry:!0,value:r.confirmPassword,onChangeText:e("confirmPassword"),onBlur:t("confirmPassword"),style:He.input}),o.confirmPassword&&n.confirmPassword&&(0,g.jsx)(_.default,{style:He.error,children:n.confirmPassword}),s&&(0,g.jsx)(_.default,{style:He.error,children:s}),(0,g.jsx)(re.default,{mode:"contained",onPress:a,style:He.button,disabled:i,loading:i,children:"Guardar contrase\xf1a"})]})})})]})})})},He=p.default.create({container:{flex:1,width:"100%",alignItems:"center",padding:20,justifyContent:"center"},card:{width:"100%",maxWidth:600},input:{marginBottom:10},button:{marginTop:10},error:{color:"red",marginBottom:10}});const qe=()=>{const{width:e}=(0,w.default)(),t=e>=900?2:1,{user:a,token:r}=y(),i=(0,n.useNavigation)(),{aulas:o}=I(),[s,d]=(0,l.useState)(!0),[c,u]=(0,l.useState)([]);(0,l.useEffect)((()=>{a?.is_teacher||(async e=>{const t=await async function(e){const t=await fetch(`${D}/asistencias/mis-asistencias`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(e);u(t),d(!1)})(r)}),[s]);return(0,g.jsxs)(A,{children:[(0,g.jsxs)(b.default,{style:Je.header,children:[(0,g.jsx)(_.default,{variant:"titleLarge",style:Je.title,children:"Mis Materias"}),(0,g.jsx)(_.default,{variant:"bodyMedium",style:Je.subtitle,children:a?.is_teacher?"Lista de materias que dictas":"Lista de materias que cursas"})]}),(0,g.jsx)(v.default,{contentContainerStyle:{paddingBottom:32,gap:12,flexDirection:t>1?"row":"column",flexWrap:t>1?"wrap":"nowrap",justifyContent:t>1?"center":"flex-start"},children:o.map((r=>{const n=c.find((e=>e.aula_id===r.id)),o=n?.porcentaje_asistencia,l=c.find((e=>e.aula_id===r.id)),s=l?.asistencias||[];return(0,g.jsx)(b.default,{style:[Je.card,t>1&&{width:e/2-24,marginHorizontal:6}],children:(0,g.jsx)(Ne,{materia:r,onPress:()=>((e,t)=>{i.navigate("MateriasStack",{screen:"DetalleMateria",params:{materia:e,asistencia:t}})})(r,s),porcentaje:o,is_alumno:!a?.is_teacher,alarcoin:void 0})},r.id)}))})]})},Je=p.default.create({container:{padding:16,justifyContent:"center",alignItems:"center"},header:{marginBottom:24},title:{fontWeight:"bold"},subtitle:{marginTop:4,color:"#6b7280"},card:{marginBottom:16},cardContent:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},infoLeft:{flex:1,gap:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},scheduleText:{color:"#6b7280"},infoRight:{alignItems:"flex-end"},label:{color:"#6b7280"},classCount:{marginTop:2,fontWeight:"600"}});function Ue({visible:e,onClose:t,clase:a}){const{token:r}=y(),{alumnosMap:n,aulas:i}=I(),[o,s]=(0,l.useState)([]),[d,c]=(0,l.useState)(!0),[u,f]=(0,l.useState)([]),{colors:m}=(0,B.useTheme)(),{width:h}=(0,w.default)(),x=h<600,j=h>=1e3?3:h>=700?2:1,p=i.find((e=>e.id===a.aula_id)),S=p?.alumnoIds.map((e=>n[e])).filter(Boolean)??[];(0,l.useEffect)((()=>{if(!e)return;c(!0);(async()=>{try{const e=await async function(e,t){const a=await fetch(`${D}/asistencias/asistencias-por-clase/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(a.id,r);if(s(e),0===e.length){const e=S.map((e=>({alumno_id:e.id,presente:1})));f(e)}}catch(e){console.error("Error al obtener asistencias:",e)}finally{c(!1)}})(),f([])}),[e,a.id]),(0,l.useEffect)((()=>{e||(s([]),f([]))}),[e]);return(0,g.jsx)(De.default,{children:(0,g.jsxs)(ze.default,{visible:e,onDismiss:t,contentContainerStyle:[Ze.modalContainer,{backgroundColor:m.background}],children:[(0,g.jsxs)(_.default,{variant:"titleMedium",style:Ze.headerTitle,children:["Asistencia - ",a.tema]}),d?(0,g.jsx)(M.default,{style:{marginVertical:20}}):(0,g.jsx)(v.default,{contentContainerStyle:Ze.scroll,children:(0,g.jsx)(b.default,{style:[Ze.grid,{gap:12}],children:S.map((e=>{const t=o.find((t=>t.alumno_id===e.id)),a=u.find((t=>t.alumno_id===e.id)),r=a?.presente?.toString()??t?.presente?.toString()??"",n=a?.justificado??t?.justificado??"";return(0,g.jsx)(b.default,{style:[Ze.cardWrapper,{width:100/j-4+"%"}],children:(0,g.jsx)(R.default,{mode:"outlined",style:Ze.alumnoCard,children:(0,g.jsxs)(R.default.Content,{style:{gap:4,padding:5},children:[(0,g.jsxs)(_.default,{style:Ze.nombreAlumno,children:[e.nombre," ",e.apellido]}),(0,g.jsx)(Me.default.Group,{onValueChange:t=>{return a=e.id,r=parseInt(t),void f((e=>e.find((e=>e.alumno_id===a))?e.map((e=>e.alumno_id===a?Object.assign({},e,{presente:r}):e)):[...e,{alumno_id:a,presente:r}]));var a,r},value:r,children:(0,g.jsxs)(b.default,{style:Ze.radioRowFixed,children:[(0,g.jsx)(Me.default.Item,{label:x?"P":"Presente",value:"1",style:Ze.radioItemFixed,labelStyle:x?Ze.radioLabelMobile:Ze.radioLabel}),(0,g.jsx)(Me.default.Item,{label:x?"A":"Ausente",value:"2",style:Ze.radioItemFixed,labelStyle:x?Ze.radioLabelMobile:Ze.radioLabel}),(0,g.jsx)(Me.default.Item,{label:x?"T":"Tarde",value:"3",style:Ze.radioItemFixed,labelStyle:x?Ze.radioLabelMobile:Ze.radioLabel}),(0,g.jsx)(Me.default.Item,{label:x?"NC":"No corresponde",value:"0",style:Ze.radioItemFixed,labelStyle:x?Ze.radioLabelMobile:Ze.radioLabel})]})}),(0,g.jsx)(se.default,{label:"Justificaci\xf3n",mode:"outlined",value:n,onChangeText:t=>{return a=e.id,r=t,void f((e=>e.find((e=>e.alumno_id===a))?e.map((e=>e.alumno_id===a?Object.assign({},e,{justificado:r}):e)):[...e,{alumno_id:a,presente:2,justificado:r}]));var a,r}})]})})},e.id)}))})}),(0,g.jsxs)(b.default,{style:Ze.buttonRow,children:[(0,g.jsx)(re.default,{mode:"text",onPress:t,children:"Cancelar"}),(0,g.jsx)(re.default,{mode:"contained",onPress:async()=>{try{if(0===u.length)return void le.default.alert("Sin cambios","No se detectaron asistencias editadas.");const e=S.map((e=>{const t=u.find((t=>t.alumno_id===e.id));return{alumno_id:e.id,presente:t?.presente??1,justificado:t?.justificado??"no"}}));console.log("Payload a enviar:",e),await async function(e,t,a){console.log(a);const r=await fetch(`${D}/asistencias/masiva/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)});if(!r.ok){const e=await r.json();throw new Error(e.detail||"Error al guardar asistencias")}}(a.id,r,e),le.default.alert("Guardado","Las asistencias fueron actualizadas correctamente."),f([]),t()}catch(e){console.error("Error al guardar asistencias:",e),le.default.alert("Error",e.message||"Ocurri\xf3 un error al guardar.")}},children:"Guardar"})]})]})})}const Ze=p.default.create({modalContainer:{margin:10,padding:20,borderRadius:12,maxHeight:"95%"},scroll:{paddingVertical:5},headerTitle:{marginBottom:12},grid:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},cardWrapper:{marginBottom:16},alumnoCard:{borderRadius:12},nombreAlumno:{fontWeight:"600",marginBottom:4},radioRow:{flexDirection:"row",justifyContent:"space-evenly"},buttonRow:{flexDirection:"row",justifyContent:"flex-end",marginTop:20,gap:10},radioRowFixed:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"nowrap",gap:0},radioItemFixed:{flex:1,margin:0,padding:0},radioLabel:{fontSize:14},radioLabelMobile:{fontSize:12}});function Ke({clase:e,asistencia:t}){const[a,r]=(0,l.useState)(!1),{user:n}=y(),{colors:i}=(0,B.useTheme)();return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(R.default,{style:[Qe.card],children:(0,g.jsx)(k.LinearGradient,{colors:n?.is_teacher?["#trnasparent","transparent"]:(e=>1===e?[i.background,i.asistenciaBuena]:2===e?[i.background,i.asistenciaMala]:3===e?[i.background,i.asistenciaMedia]:["transparent","transparent"])(t?.presente),start:{x:.4,y:.3},end:{x:1,y:1},style:{borderRadius:8,padding:10},children:(0,g.jsxs)(R.default.Content,{children:[(0,g.jsxs)(b.default,{style:Qe.headerRow,children:[(0,g.jsx)(_.default,{variant:"titleSmall",style:Qe.cardTitle,children:e.tema}),(0,g.jsx)(b.default,{style:Qe.iconButtons,children:n?.is_teacher?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(W.default,{name:"create-outline",size:20,color:"#9CA3AF",style:Qe.iconMargin}),(0,g.jsx)(W.default,{name:"trash-outline",size:20,color:"#9CA3AF"})]}):(0,g.jsxs)(_.default,{variant:"bodyMedium",children:[" ",t?1===t.presente?"Presente":2===t.presente?"Ausente":"Tarde":"Sin asistencia"]})})]}),(0,g.jsxs)(b.default,{style:Qe.scheduleRow,children:[(0,g.jsx)(W.default,{name:"calendar-outline",size:13,color:"#9CA3AF",style:Qe.iconMargin}),(0,g.jsx)(_.default,{variant:"bodySmall",style:Qe.cardSubtitle,children:e.fecha.toString()})]}),n?.is_teacher&&(0,g.jsx)(re.default,{mode:"outlined",icon:"account-check-outline",style:Qe.attendanceButton,onPress:()=>r(!0),children:"Tomar asistencia"})]})})}),(0,g.jsx)(Ue,{visible:a,onClose:()=>r(!1),clase:e})]})}const Qe=p.default.create({card:{width:"100%",maxWidth:400,borderRadius:8,elevation:2,alignSelf:"center",marginHorizontal:15,marginBottom:10},headerRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},iconButtons:{flexDirection:"row"},iconMargin:{marginRight:8},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4},cardTitle:{fontWeight:"bold",marginBottom:4},cardSubtitle:{color:"#6B7280"},attendanceButton:{marginTop:10},modalBackdrop:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center"},modalContainer:{width:"85%",padding:20,backgroundColor:"white",borderRadius:10,elevation:5},modalCloseButton:{marginTop:20,alignSelf:"flex-end"},modalCloseText:{color:"#2563EB",fontWeight:"bold"}});function Xe(){const{width:e}=(0,w.default)(),t=(0,n.useRoute)(),{materia:r,asistencia:i}=t.params,o=(0,n.useNavigation)(),{token:s,user:d}=y(),[c,f]=(0,l.useState)(!0),[m,h]=(0,l.useState)([]),[x,j]=(0,l.useState)(!1),{colors:p}=(0,B.useTheme)(),S=async()=>{let e=s;s||(e=await u("token"));try{const t=await async function(e,t){const a=await fetch(`${D}/clases/aulas/${e}/clases`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(r.id,e);h(t)}catch(x){console.log("error al obtener las clases",x),j(!0)}finally{f(!1)}},C=d?.is_teacher?m:m.filter((e=>!/^clases\s+\d+/i.test(e.tema))),T=e>=1024?3:e>=600?2:1,k=e<600;(0,l.useEffect)((()=>{S()}),[c]);const E=()=>{};return(0,g.jsx)(A,{children:(0,g.jsxs)(b.default,{style:Ye.container,children:[(0,g.jsxs)(b.default,{style:[Ye.sectionHeader,k&&{flexDirection:"column",alignItems:"flex-start",gap:8}],children:[(0,g.jsxs)(b.default,{style:[Ye.headerRow,k&&{flexDirection:"row",alignItems:"center"}],children:[(0,g.jsx)(re.default,{onPress:()=>{o.goBack()},mode:"text",compact:!0,icon:({size:e,color:t})=>(0,g.jsx)(W.default,{name:"arrow-back",size:16,color:p.primary}),contentStyle:Ye.backButton,labelStyle:[Ye.backButtonText,k&&{display:"none"}],children:!k&&"Volver"}),(0,g.jsx)(_.default,{variant:k?"titleSmall":"titleMedium",style:[Ye.subjectTitle,{flexShrink:1,flexWrap:"wrap",maxWidth:k?"90%":"100%"}],numberOfLines:1,ellipsizeMode:"tail",children:r.nombre})]}),(0,g.jsx)(b.default,{children:(0,g.jsxs)(b.default,{style:Ye.scheduleRow,children:[(0,g.jsx)(W.default,{name:"clipboard",size:14,color:"#6B7280"}),(0,g.jsx)(_.default,{variant:"bodySmall",style:Ye.subjectSchedule,children:`${r.ano}\xb0 ${r.division}\xb0 - ${r.especialidad}`})]})}),d?.is_teacher&&(0,g.jsx)(b.default,{children:(0,g.jsx)(re.default,{icon:"plus",mode:"contained",onPress:E,contentStyle:Ye.addButtonContent,style:Ye.addButton,children:"Agregar Clase"})})]}),c?(0,g.jsx)(M.default,{size:"large",color:"violet"}):x?(0,g.jsxs)(b.default,{style:{alignItems:"center",justifyContent:"center",flex:1},children:[(0,g.jsx)(_.default,{variant:"titleLarge",style:{marginBottom:12,color:"#9333EA",textAlign:"center"},children:"Ocurri\xf3 un error al cargar las clases"}),(0,g.jsx)(We.default,{source:a(2058),style:{width:180,height:180,marginBottom:20,borderRadius:90,opacity:.85},resizeMode:"contain"}),(0,g.jsx)(re.default,{mode:"contained",onPress:()=>{f(!0),j(!1),S()},style:{marginTop:8},children:"Reintentar"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(v.default,{contentContainerStyle:{paddingBottom:d?.is_teacher?90:32,paddingHorizontal:6,gap:10},showsVerticalScrollIndicator:!1,children:0===C.length?(0,g.jsxs)(b.default,{style:Ye.centered,children:[(0,g.jsx)(W.default,{name:"information-circle-outline",size:48,color:"#A78BFA"}),(0,g.jsx)(_.default,{style:{color:"#6B7280",marginTop:12,textAlign:"center"},children:"No hay clases registradas a\xfan."})]}):((e,t)=>{const a=[];for(let r=0;r<e.length;r+=t)a.push(e.slice(r,r+t));return a})(C,T).map(((e,t)=>(0,g.jsxs)(b.default,{style:{flexDirection:"row",justifyContent:T>1?"center":"flex-start",marginBottom:10,gap:10},children:[e.map((e=>{const t=i.find((t=>t.id===e.id));return(0,g.jsx)(b.default,{style:{flex:1,maxWidth:100/T+"%"},children:(0,g.jsx)(b.default,{style:Ye.cardShadow,children:(0,g.jsx)(Ke,{clase:e,asistencia:t})})},e.id)})),e.length<T&&Array.from({length:T-e.length}).map(((e,t)=>(0,g.jsx)(b.default,{style:{flex:1,maxWidth:100/T+"%",minHeight:120}},`empty-${t}`)))]},t)))}),d?.is_teacher&&(0,g.jsx)(b.default,{style:Ye.fabContainer,children:(0,g.jsx)(re.default,{icon:"plus",mode:"contained",onPress:E,contentStyle:Ye.addButtonContent,style:Ye.addButton,labelStyle:{fontWeight:"bold",fontSize:16},children:"Agregar Clase"})})]})]})})}const Ye=p.default.create({container:{flex:1,padding:10},backButton:{flexDirection:"row",alignItems:"center",paddingLeft:0},backButtonText:{color:"#4B5563",fontSize:14,marginLeft:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},subjectTitle:{fontWeight:"bold"},subjectSchedule:{color:"#6B7280",marginTop:4,marginBottom:4},sectionHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginTop:8},addButton:{borderRadius:8,marginVertical:10},addButtonContent:{flexDirection:"row"},headerRow:{flexDirection:"row",alignItems:"center",gap:8}}),et=(0,i.createNativeStackNavigator)();function tt(){return(0,g.jsxs)(et.Navigator,{screenOptions:{headerShown:!1},children:[(0,g.jsx)(et.Screen,{name:"Materias",component:qe,options:{title:"adminAulas | Mis Materias"}}),(0,g.jsx)(et.Screen,{name:"DetalleMateria",component:Xe,options:{title:"adminAulas | Detalle de Materia"}})]})}const at=(0,i.createNativeStackNavigator)(),rt=(0,o.createDrawerNavigator)();function nt(){const{colors:e}=(0,B.useTheme)(),{user:t}=y(),a=(0,l.useMemo)((()=>t),[t]);return(0,g.jsxs)(rt.Navigator,{drawerContent:e=>(0,g.jsx)(Ae,Object.assign({},e)),screenOptions:({navigation:t})=>({headerStyle:{backgroundColor:e.elevation.level2},headerTintColor:e.primary,headerTitleStyle:{fontWeight:"bold"},headerRight:()=>(0,g.jsx)(b.default,{style:{padding:2},children:(0,g.jsx)(fe.default,{onPress:()=>t.navigate("Perfil"),style:{},children:(0,g.jsx)(H.default,{label:xe(a?.nombre,a?.apellido),size:40,style:{backgroundColor:e.primary,width:40,height:40,marginRight:10}})})})}),children:[(0,g.jsx)(rt.Screen,{name:"Home",component:K,options:{title:"adminAulas | Dashboard"}}),(0,g.jsx)(rt.Screen,{name:"MateriasStack",component:tt,options:{title:"adminAulas | Mis Materias"}}),(0,g.jsx)(rt.Screen,{name:"Perfil",component:ue,options:{title:"adminAulas | Mi Perfil"}}),(0,g.jsx)(rt.Screen,{name:"Alarcoin",component:Ve,options:{title:"adminAulas | Mis Alarcoin"}})]})}const it=()=>{const{user:e}=y(),{theme:t}=Be(),a=t.dark?Object.assign({},n.DarkTheme,{colors:Object.assign({},n.DarkTheme.colors,t.colors)}):Object.assign({},n.DefaultTheme,{colors:Object.assign({},n.DefaultTheme.colors,t.colors)});return(0,g.jsx)(n.NavigationContainer,{theme:a,children:(0,g.jsx)(at.Navigator,{children:e?e.cambiarContrasena?(0,g.jsx)(at.Screen,{name:"CambiarContra",component:Ge,options:{title:"adminAulas | Cambiar Contrase\xf1a",headerShown:!1}}):(0,g.jsx)(at.Screen,{name:"Main",component:nt,options:{headerShown:!1}}):(0,g.jsx)(at.Screen,{name:"Login",component:ie,options:{headerShown:!1}})})})};function ot(){return(0,g.jsx)(j,{children:(0,g.jsx)(z,{children:(0,g.jsx)(it,{})})})}var lt=a(4465),st=a(9836),dt=a(1667),ct=a(2059),ut=a(535);const ft=({onFinish:e})=>{const{colors:t}=(0,B.useTheme)(),a=new ut.default.Value(0);return(0,l.useEffect)((()=>{ut.default.timing(a,{toValue:1,duration:1e3,useNativeDriver:!0}).start((()=>{setTimeout((()=>{ut.default.timing(a,{toValue:.5,duration:500,useNativeDriver:!0}).start((()=>{e()}))}),1e3)}))}),[]),(0,g.jsx)(ut.default.View,{style:[mt.container,{opacity:a},{backgroundColor:O}],children:(0,g.jsx)(_.default,{variant:"titleLarge",style:mt.title,children:"AdminAulas \ud83d\ude80"})})},mt=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},title:{fontSize:32,fontWeight:"bold"}});function ht(){const{theme:e,isDarkMode:t}=Be();return(0,g.jsxs)(lt.default,{theme:e,children:[(0,g.jsx)(st.StatusBar,{style:t?"light":"dark"}),(0,g.jsx)(ot,{})]})}ct.preventAutoHideAsync(),(0,r.default)((function(){const[e]=(0,dt.useFonts)(Object.assign({},J.default.font)),[t,a]=(0,l.useState)(!0),r=(0,l.useCallback)((async()=>{}),[e]);return(0,l.useEffect)((()=>{e&&r()}),[e]),e?(0,g.jsx)(ke,{children:t?(0,g.jsx)(ft,{onFinish:async()=>{a(!1),await ct.hideAsync()}}):(0,g.jsx)(ht,{})}):null}))},2058:(e,t,a)=>{e.exports=a.p+"static/media/errorImagen.a23f855f5c97c01c10ea.png"}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,a),i.exports}a.m=e,(()=>{var e=[];a.O=(t,r,n,i)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,n,i]=e[c],l=!0,s=0;s<r.length;s++)(!1&i||o>=i)&&Object.keys(a.O).every((e=>a.O[e](r[s])))?r.splice(s--,1):(l=!1,i<o&&(o=i));if(l){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/",(()=>{var e={792:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var n,i,[o,l,s]=r,d=0;if(o.some((t=>0!==e[t]))){for(n in l)a.o(l,n)&&(a.m[n]=l[n]);if(s)var c=s(a)}for(t&&t(r);d<o.length;d++)i=o[d],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=a.O(void 0,[404],(()=>a(990)));r=a.O(r)})();
//# sourceMappingURL=main.cb595a96.js.map