(()=>{"use strict";var e={776:(e,a,t)=>{t.r(a);var r=t(4636),n=t(3841),o=t(3923),i=t(5991),l=t(9649),s=t(733);const c=async e=>{try{await s.default.setItem("user",JSON.stringify(e))}catch(a){console.error("Error guardando el usuario:",a)}},d=async(e,a)=>{try{await s.default.setItem(e,a)}catch(t){console.error("Error guardando en storage:",t)}},u=async e=>{try{return await s.default.getItem(e)}catch(a){return console.error("Error obteniendo de storage:",a),null}},f=async e=>{try{await s.default.removeItem(e)}catch(a){console.error("Error eliminando de storage:",a)}},m=async e=>{try{await s.default.setItem("aulas",JSON.stringify(e))}catch(a){console.log("error al guardar materias",a)}},h=async()=>{try{const e=await s.default.getItem("aulas");return null!=e?JSON.parse(e):null}catch(e){return console.log("no hay aulas",e),null}},g=async()=>{try{const e=await u("alarcoins_profe");return e?JSON.parse(e):null}catch(e){return console.error("Error al leer alarcoins profe:",e),null}},x=async()=>{try{const e=await u("alarcoins_alumno");return e?JSON.parse(e):null}catch(e){return console.error("Error al leer alarcoin del alumno:",e),null}},y=async(e,a)=>{try{await s.default.setItem(`clases_${e}`,JSON.stringify(a))}catch(t){console.error("Error guardando clases:",t)}},j=async e=>{try{const a=await s.default.getItem(`clases_${e}`);return a?JSON.parse(a):null}catch(a){return console.error("Error leyendo clases:",a),null}};var p=t(8853);const b=(0,l.createContext)({user:null,setUser:()=>{},token:null,setToken:()=>{},logout:()=>{},loading:!0}),w=({children:e})=>{const[a,t]=(0,l.useState)(null),[r,n]=(0,l.useState)(!0),[o,i]=(0,l.useState)(null);(0,l.useEffect)((()=>{(async()=>{const e=await(async()=>{try{const e=await s.default.getItem("user");return null!==e?JSON.parse(e):null}catch(e){return console.error("Error obteniendo el usuario:",e),null}})(),a=await u("token");e&&t(e),a&&i(a),n(!1)})()}),[]);return(0,p.jsx)(b.Provider,{value:{user:a,setUser:t,loading:r,token:o,setToken:i,logout:async()=>{try{await f("token"),await f("user"),await f("aulas")}catch(e){console.log("error al borrar items",e)}t(null),i(null)}},children:e})},v=()=>(0,l.useContext)(b);var S=t(4147),C=t(3198),T=t(143),k=t(8363),E=t(5220),B=t(5830),z=t(9978),A=t(3997),P=t(4642);const D=({children:e})=>{const{colors:a}=(0,P.useTheme)();return(0,p.jsx)(A.LinearGradient,{colors:[a.primary,a.background],start:{x:.6,y:1},end:{x:.5,y:0},style:I.gradient,children:(0,p.jsx)(B.default,{style:I.safeArea,children:(0,p.jsx)(E.default,{style:I.flex,behavior:"height",keyboardVerticalOffset:z.default.currentHeight||0,children:(0,p.jsx)(k.default,{contentContainerStyle:I.scrollContainer,keyboardShouldPersistTaps:"handled",children:(0,p.jsx)(C.default,{style:I.innerContainer,children:e})})})})})},I=S.default.create({gradient:{flex:1},safeArea:{flex:1,paddingTop:0},flex:{flex:1},scrollContainer:{flexGrow:1},innerContainer:{flex:1,padding:16}}),M="https://adminaulas.onrender.com";const _=(0,l.createContext)(void 0),R=({children:e})=>{const{token:a,user:t}=v(),[r,n]=(0,l.useState)([]),[o,i]=(0,l.useState)({}),[c,f]=(0,l.useState)(!0),[y,j]=(0,l.useState)(null),[b,w]=(0,l.useState)(!1),S=async e=>{(e=>{const a=Object.assign({},o);Object.keys(a).forEach((e=>{a[+e]=Object.assign({},a[+e],{alarcoin:0})})),e.forEach((e=>{e.alumnos.forEach((e=>{const t=(e=>e.reduce(((e,a)=>e+(a.suma?a.cantidad:-a.cantidad)),0))(e?.alarcoins);a[e.id]&&(a[e.id].alarcoin=(a[e.id].alarcoin||0)+t)}))})),i(a)})(e),j(e),await(async e=>{try{const a=JSON.stringify(e);await d("alarcoins_profe",a)}catch(a){console.error("Error al guardar alarcoin en storage:",a)}})(e)},C=async e=>{j(e),await(async e=>{try{const a=JSON.stringify(e);await d("alarcoins_alumno",a)}catch(a){console.error("Error al guardar alarcoin del alumno:",a)}})(e)},T=async e=>{try{const a=await h();if(a)return n(a),void f(!1);const r=await async function(e){const a=await fetch(`${M}/aulas/mis-aulas`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(e),o=r.map((e=>Object.assign({},e,{alumnos:[t],alumnoIds:[t.id]})));n(o),await m(o)}catch(a){}},k=async e=>{try{const a=await h(),t=await(async()=>{try{const e=await s.default.getItem("alumnos");if(!e)return null;const a=JSON.parse(e),t={};return a.forEach((e=>{t[e.id]=e})),t}catch(e){return console.error("Error al leer alumnos desde storage:",e),null}})();if(a&&t)return n(a),i(t),void f(!1);const r=await async function(e){const a=await fetch(`${M}/aulas/mis-aulas-con-alumnos`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(e),o={},l=r.map((e=>(e.alumnos.forEach((e=>{o[e.id]=e})),{id:e.id,nombre:e.nombre,ano:e.ano,division:e.division,especialidad:e.especialidad,profesor_id:e.profesor_id,cantidad_clases:e.cantidad_clases,alumnoIds:e.alumnos.map((e=>e.id))})));n(l),i(o),await m(l),await(async e=>{try{const a=JSON.stringify(e);await s.default.setItem("alumnos",a)}catch(a){console.error("Error al guardar alumnos:",a)}})(Object.values(o))}catch(a){console.error("Error cargando datos desde appData:",a)}finally{f(!1)}},E=async e=>{const r=e||a;r&&(t?.is_teacher?await k(r):await T(r))};return(0,l.useEffect)((()=>{E()}),[a]),(0,p.jsx)(_.Provider,{value:{aulas:r,alumnosMap:o,isLoading:c,loadData:E,alarcoins:y,loadAlarcoins:async()=>{let e=a;a||(e=await u("token")),w(!1);try{let a;t?.is_teacher?(a=await async function(e){const a=await fetch(`${M}/alarcoins/historial`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al obtener historial")}return await a.json()}(e),S(a)):(a=await async function(e){const a=await fetch(`${M}/alarcoins/me`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al obtener mis alarcoins")}return await a.json()}(e),C(a))}catch(r){console.error("Error cargando alarcoins:",r);try{if(t?.is_teacher){const e=await g();e&&await S(e)}else{const e=await x();e&&await C(e)}}catch(n){console.error("Error cargando alarcoins desde storage:",n)}w(!0)}},alarcoinsError:b},children:e})},O=()=>{const e=(0,l.useContext)(_);if(!e)throw new Error("useAppData debe usarse dentro de AppDataProvider");return e};var W=t(6437),L=t(8082);const N="#b14aca";var $=t(2317),V=t(2969),F=t(8810);const G=({title:e,value:a,icon:t,color:r="#6200ee"})=>(0,p.jsx)($.default,{style:H.card,mode:"contained",children:(0,p.jsxs)($.default.Content,{style:H.cardContent,children:[(0,p.jsx)(V.default,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:t,color:e,size:a}),style:{backgroundColor:r}}),(0,p.jsxs)(C.default,{style:{marginLeft:12},children:[(0,p.jsx)(L.default,{variant:"labelLarge",style:{color:"#777"},children:e}),(0,p.jsx)(L.default,{variant:"titleMedium",style:{fontWeight:"bold"},children:a})]})]})}),H=S.default.create({card:{width:"100%",maxWidth:600,minWidth:350,marginBottom:12,elevation:12,borderRadius:12,alignSelf:"center"},cardContent:{flexDirection:"row",alignItems:"center"}});var J=t(223),q=t(9812),U=t(2030),K=t(3231),Z=t(9454),Q=t(2520);const X=({alumnos:e})=>(0,p.jsx)($.default,{style:Y.card,children:(0,p.jsx)(J.default,{title:`Alumnos (${e.length})`,left:e=>(0,p.jsx)(q.default,Object.assign({},e,{icon:({size:e,color:a})=>(0,p.jsx)(Q.default,{name:"account-group-outline",size:e,color:a})})),right:e=>(0,p.jsx)(Q.default,{name:e.isExpanded?"chevron-up":"chevron-down",size:24,color:"#fff"}),titleStyle:Y.accordionTitle,style:Y.accordion,children:0===e.length?(0,p.jsx)(U.default,{title:"No hay alumnos",left:e=>(0,p.jsx)(q.default,Object.assign({},e,{icon:({size:e,color:a})=>(0,p.jsx)(Q.default,{name:"alert-circle-outline",size:e,color:a})})),titleStyle:{color:"#888"}}):e.map(((a,t)=>(0,p.jsxs)(C.default,{children:[(0,p.jsx)(U.default,{title:a.nombre,description:a.email,left:()=>(0,p.jsx)(K.default,{size:36,label:a.nombre?a.nombre[0].toUpperCase():"A",style:Y.avatar,color:"#fff"}),titleStyle:Y.itemTitle,descriptionStyle:Y.itemDescription,style:Y.listItem}),t<e.length-1&&(0,p.jsx)(Z.default,{})]},a.id)))})}),Y=S.default.create({card:{width:"100%",maxWidth:600,marginBottom:12,elevation:12,borderRadius:16,overflow:"hidden"},accordion:{},accordionTitle:{color:"#fff",fontWeight:"bold",fontSize:18},listItem:{backgroundColor:"#fff",paddingVertical:6,paddingHorizontal:8},itemTitle:{color:"#C93A4A",fontWeight:"600",fontSize:16},itemDescription:{color:"#888",fontSize:13},avatar:{backgroundColor:"#C93A4A",marginRight:8}}),ee=()=>{const{width:e}=(0,T.default)(),a=e<400,{user:t,loading:r}=v(),{aulas:n,alumnosMap:o,isLoading:i,alarcoins:l}=O(),s=i&&r,c=n.reduce(((e,a)=>e+(a.cantidad_clases||0)),0),{saludo:d,fecha:u}=(()=>{const e=new Date,a=e.getHours();let t;return t=a>=6&&a<12?"Buenos d\xedas":a>=12&&a<19?"Buenas tardes":"Buenas noches",{saludo:t,fecha:e.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}})();return(0,p.jsx)(D,{children:s?(0,p.jsx)(W.default,{size:"large",color:N}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(C.default,{style:[ae.header,a&&ae.headerSmall],children:[(0,p.jsxs)(C.default,{children:[(0,p.jsx)(L.default,{variant:"titleMedium",children:`${d}, ${t?.nombre}`}),(0,p.jsx)(L.default,{variant:"labelMedium",children:t?.is_teacher?"Profesor":"Alumno"})]}),(0,p.jsx)(C.default,{style:a&&{marginTop:8},children:(0,p.jsx)(L.default,{variant:"bodySmall",children:u})})]}),(0,p.jsxs)(C.default,{style:ae.cardsContainer,children:[(0,p.jsx)(G,{title:"Aulas",value:n.length,icon:"school",color:N}),(0,p.jsx)(G,{title:"Clases",value:c,icon:"calendar",color:"#C93A9F"}),t?.is_teacher&&(0,p.jsx)(X,{alumnos:Object.values(o)})]})]})})},ae=S.default.create({header:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,gap:10},headerSmall:{flexDirection:"column",alignItems:"flex-start",gap:4},cardsContainer:{flexWrap:"wrap",alignContent:"center",justifyContent:"space-between",gap:16,marginBottom:24},alumnosListContainer:{marginTop:16}});var te=t(552),re=t(500),ne=t(7799),oe=t(8488),ie=t(1561);var le=t(397);const se=ie.object().shape({email:ie.string().email("Email inv\xe1lido").required("Requerido"),password:ie.string().min(6,"M\xednimo 6 caracteres").required("Requerido")});function ce(){const e=(0,n.useNavigation)(),{loading:a,setUser:t,setToken:r}=v(),{loadData:o}=O(),{colors:i}=(0,P.useTheme)(),l=async(a,n,i,l)=>{try{const n=await async function(e){const a=await fetch(`${M}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(a);l(),t(n.user),r(n.access_token),await c(n.user),await d("token",n.access_token),o(n.access_token),e.navigate("Main")}catch(s){i("Credenciales inv\xe1lidas")}finally{n(!1)}};return(0,p.jsx)(D,{children:a?(0,p.jsx)(te.default,{children:"Cargando ..."}):(0,p.jsx)(C.default,{style:de.container,children:(0,p.jsxs)(C.default,{style:de.card,children:[(0,p.jsx)(te.default,{style:de.title,children:"Iniciar sesi\xf3n"}),(0,p.jsx)(oe.Formik,{initialValues:{email:"",password:""},validationSchema:se,onSubmit:(e,{setSubmitting:a,setErrors:t,resetForm:r})=>l(e,a,(e=>t({password:e})),r),children:({handleChange:e,handleBlur:a,handleSubmit:t,values:r,errors:n,touched:o,isSubmitting:l})=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(re.default,{style:de.input,placeholder:"Email",onChangeText:e("email"),onBlur:a("email"),value:r.email,keyboardType:"email-address",autoCapitalize:"none"}),o.email&&n.email&&(0,p.jsx)(te.default,{style:de.error,children:n.email}),(0,p.jsx)(re.default,{style:de.input,placeholder:"Contrase\xf1a",onChangeText:e("password"),onBlur:a("password"),value:r.password,secureTextEntry:!0}),o.password&&n.password&&(0,p.jsx)(te.default,{style:de.error,children:n.password}),(0,p.jsx)(le.default,{onPress:t,style:{backgroundColor:i.backdrop,paddingVertical:8,marginTop:15},children:l?(0,p.jsx)(ne.default,{color:"#fff"}):(0,p.jsx)(te.default,{style:de.buttonText,children:"Ingresar"})})]})})]})})})}const de=S.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},card:{width:"85%",padding:24,borderRadius:12,backgroundColor:"#fefefe80",elevation:6,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:5,maxWidth:400},title:{fontSize:22,fontWeight:"bold",marginBottom:16,textAlign:"center"},input:{height:48,borderColor:"#ccc",borderWidth:1,borderRadius:8,paddingHorizontal:12,marginTop:12,backgroundColor:"#fff"},error:{color:"red",fontSize:12,marginTop:4,marginLeft:4},buttonText:{color:"#fff",fontWeight:"600",fontSize:16}});var ue=t(9343),fe=t(4423);const me=ie.object({name:ie.string().required("El nombre es obligatorio"),email:ie.string().email("Correo inv\xe1lido").required("El correo es obligatorio"),currentPassword:ie.string().required("Campo obligatorio"),newPassword:ie.string().min(6,"Debe tener al menos 6 caracteres")}),he=S.default.create({container:{flexGrow:1,padding:15,alignItems:"center",minHeight:"100%"},header:{fontWeight:"bold",fontSize:28,marginTop:16,marginBottom:4,alignSelf:"flex-start",letterSpacing:.5},subheader:{marginBottom:16,alignSelf:"flex-start",fontSize:16,opacity:.85},avatarContainer:{alignItems:"center",marginVertical:16,width:"100%"},cardheader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingRight:8,paddingTop:8},cardTitle:{fontSize:20,fontWeight:"bold"},cardSubtitle:{fontSize:14},editButton:{marginTop:16,borderRadius:20,minWidth:120,elevation:0,alignSelf:"center"},card:{width:"100%",maxWidth:500,alignSelf:"center",marginTop:16,paddingHorizontal:0,borderRadius:16,elevation:2},form:{gap:8,marginTop:8,width:"100%"},input:{marginBottom:4},error:{fontSize:12,marginBottom:4,marginLeft:4},buttonGroup:{marginTop:16,flexDirection:"row",justifyContent:"flex-end",gap:8},saveButton:{marginLeft:8,borderRadius:20,minWidth:100},cancelButton:{borderColor:"#ccc",borderRadius:20,minWidth:100},logoutButton:{marginTop:32,width:"100%",maxWidth:500,alignSelf:"center",borderRadius:20,borderWidth:1,borderColor:"#e53935",color:"#e53935"}}),ge=()=>{const{user:e}=v(),[a,t]=(0,l.useState)(!1),[r,n]=(0,l.useState)(e?.nombre),[o,i]=(0,l.useState)(e?.apellido),[s]=(0,l.useState)(e?.email),{colors:c}=(0,P.useTheme)(),{width:d}=(0,T.default)(),[u,f]=(0,l.useState)(""),[m,h]=(0,l.useState)(""),g=()=>t(!0),x=()=>{t(!1),f(""),h("")};return(0,p.jsx)(D,{children:(0,p.jsxs)(k.default,{contentContainerStyle:[he.container,,],children:[(0,p.jsx)(L.default,{variant:"titleLarge",style:[he.header,{color:c.primary}],children:"Perfil"}),(0,p.jsx)(L.default,{variant:"bodyMedium",style:[he.subheader,{color:c.onSurfaceVariant}],children:"Administra tu informaci\xf3n personal"}),(0,p.jsxs)($.default,{style:[he.card,{backgroundColor:c.surface}],children:[(0,p.jsx)(C.default,{style:he.cardheader,children:(0,p.jsx)($.default.Title,{title:"Informaci\xf3n Personal",subtitle:"Actualiza tu informaci\xf3n de cuenta",titleStyle:[he.cardTitle,{color:c.primary}],subtitleStyle:[he.cardSubtitle,{color:c.onSurfaceVariant}]})}),(0,p.jsx)(Z.default,{style:{marginBottom:8,backgroundColor:c.outlineVariant}}),(0,p.jsx)($.default.Content,{children:(0,p.jsx)(oe.Formik,{initialValues:{name:r||"",apellido:o||"",email:s||"",newPassword:"",confirmPassword:""},validationSchema:me,onSubmit:e=>{u&&u!==m?ue.default.alert("Error","Las contrase\xf1as no coinciden."):t(!1)},enableReinitialize:!0,children:({handleChange:e,handleBlur:t,handleSubmit:l,values:y,errors:j,touched:b})=>(0,p.jsxs)(C.default,{style:he.form,children:[(0,p.jsx)(fe.default,{label:"Nombre",value:r,onChangeText:n,editable:a,mode:"flat",style:[he.input,{backgroundColor:a?c.background:c.surfaceDisabled}],error:!!j.name&&b.name,onBlur:t("name"),left:(0,p.jsx)(fe.default.Icon,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"person-outline",color:e,size:a})})}),a&&j.name&&b.name&&(0,p.jsx)(L.default,{style:[he.error,{color:c.error}],children:j.name}),(0,p.jsx)(fe.default,{label:"Apellido",value:o,onChangeText:i,editable:a,mode:"flat",style:[he.input,{backgroundColor:a?c.background:c.surfaceDisabled}],error:!!j.apellido&&b.apellido,onBlur:t("apellido"),left:(0,p.jsx)(fe.default.Icon,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"person-outline",color:e,size:a})})}),a&&j.apellido&&b.apellido&&(0,p.jsx)(L.default,{style:[he.error,{color:c.error}],children:j.apellido}),(0,p.jsx)(fe.default,{label:"Email",value:s,editable:!1,mode:"flat",style:[he.input,{backgroundColor:c.surfaceDisabled}],left:(0,p.jsx)(fe.default.Icon,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"mail-outline",color:e,size:a})})}),a&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(fe.default,{label:"Nueva clave",secureTextEntry:!0,textContentType:"oneTimeCode",value:u,onChangeText:f,placeholder:"********",mode:"flat",style:[he.input,{backgroundColor:c.background}],error:!!j.newPassword&&b.newPassword,onBlur:t("newPassword"),left:(0,p.jsx)(fe.default.Icon,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"lock-closed-outline",color:e,size:a})})}),j.newPassword&&b.newPassword&&(0,p.jsx)(L.default,{style:[he.error,{color:c.error}],children:j.newPassword}),(0,p.jsx)(fe.default,{label:"Repetir clave",secureTextEntry:!0,value:m,onChangeText:h,placeholder:"********",mode:"flat",style:[he.input,,],left:(0,p.jsx)(fe.default.Icon,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"lock-closed-outline",color:e,size:a})})}),(0,p.jsxs)(C.default,{style:he.buttonGroup,children:[(0,p.jsx)(le.default,{mode:"outlined",style:[he.cancelButton,{borderColor:c.outline},d<400&&{flex:1}],onPress:x,labelStyle:{color:c.primary},children:"Cancelar"}),(0,p.jsx)(le.default,{mode:"contained",style:[he.saveButton,{backgroundColor:c.primary},d<400&&{flex:1}],onPress:l,labelStyle:{color:c.onPrimary},children:"Guardar"})]})]}),!a&&(0,p.jsx)(le.default,{style:[he.editButton,{backgroundColor:c.primary},d<400&&{width:"100%",alignSelf:"center"}],mode:"contained",icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"pencil",color:e,size:a}),onPress:g,labelStyle:{color:c.onPrimary,fontSize:16},contentStyle:{paddingVertical:8},children:"Editar"})]})})})]})]})})};var xe=t(3124),ye=t(193),je=t(2773),pe=t(2149);const be=(e,a)=>`${e?.trim()?.[0]?.toUpperCase()??""}${a?.trim()?.[0]?.toUpperCase()??""}`,we=S.default.create({profile:{alignItems:"center",marginBottom:16,maxWidth:350,margin:10,width:"100%"},avatar:{backgroundColor:"#c001f5"},name:{marginTop:8,fontWeight:"bold"},role:{fontSize:14,color:"#6b7280"}}),ve=({alarcoins:e,isalarcoins:a=!1,user:t,loading:r})=>{const{colors:o}=(0,n.useTheme)();return(0,p.jsxs)(C.default,{style:[we.profile,a&&{backgroundColor:o.background,borderRadius:12,padding:16,elevation:2,shadowColor:"#000",shadowOffset:{width:0,height:1},shadowOpacity:.2,shadowRadius:1.41}],children:[(0,p.jsx)(K.default,{label:be(t?.nombre,t?.apellido),size:64,style:we.avatar}),(0,p.jsx)(L.default,{variant:"titleLarge",style:we.name,children:r?"Cargando":`${t?.nombre} ${t?.apellido}`}),!a&&(0,p.jsx)(L.default,{variant:"bodySmall",style:we.role,children:r?"cargando":t?.is_teacher?"Profesor":"Alumno"}),a&&(0,p.jsxs)(C.default,{children:[(0,p.jsx)(L.default,{variant:"bodyMedium",children:"Tus Alarcoins"}),(0,p.jsx)(L.default,{variant:"bodyMedium",style:{textAlign:"center"},children:e})]})]})};var Se=t(6573),Ce=t(4821),Te=t(995);const ke=Object.assign({},Ce.MD3LightTheme,{colors:Object.assign({},Ce.MD3LightTheme.colors,{primary:"#d83dff",background:"#d1a3ff",surface:"#d1a3ff",text:"#2b2b2b",secondary:"#4ab19f",accent:"#f2c94c",asistenciaBuena:"#10b981",asistenciaMedia:"#ffb93f",asistenciaMala:"#ef4444"})}),Ee=Object.assign({},Te.MD3DarkTheme,{colors:Object.assign({},Te.MD3DarkTheme.colors,{primary:"#b14aca",background:"#302f2f",surface:"#1e1e1e",text:"#ffffff",secondary:"#4ab19f",accent:"#f2c94c",asistenciaBuena:"#097551",asistenciaMedia:"#f59e0b",asistenciaMala:"#e21313"})});var Be=t(2162);const ze=(0,l.createContext)({isDarkMode:!1,toggleTheme:()=>{},theme:ke}),Ae=({children:e})=>{const a=(0,Be.default)(),[t,r]=(0,l.useState)(!0),[n,o]=(0,l.useState)("dark"===a);(0,l.useEffect)((()=>{(async()=>{const e=await u("theme");"light"===e||"dark"===e?(r(!1),o("dark"===e)):(r(!0),o("dark"===a))})()}),[]),(0,l.useEffect)((()=>{t&&a&&o("dark"===a)}),[a,t]),(0,l.useEffect)((()=>{const e=Se.default.addChangeListener((({colorScheme:e})=>{o("dark"===e)}));return()=>e.remove()}),[]);const i=n?Ee:ke;return(0,p.jsx)(ze.Provider,{value:{isDarkMode:n,toggleTheme:async()=>{const e=!n;o(e),r(!1),await d("theme",e?"dark":"light")},theme:i},children:e})},Pe=()=>(0,l.useContext)(ze);function De(e){const{isDarkMode:a,toggleTheme:t}=Pe(),{user:r,loading:o,logout:l}=v(),s=[{icon:"grid-outline",label:"Dashboard",screen:"Home"},{icon:"person-outline",label:"Perfil",screen:"Perfil"},{icon:"book-outline",label:"Mis Aulas",screen:"MateriasStack"},{icon:"logo-bitcoin",label:r?r.is_teacher?"Alarcoins":"Mis Alarcoins":"Alarcoins",screen:"Alarcoin"}],c=(0,n.useNavigation)();return(0,p.jsx)(i.DrawerContentScrollView,Object.assign({},e,{contentContainerStyle:{flex:1},children:(0,p.jsxs)(C.default,{style:Ie.container,children:[(0,p.jsx)(ve,{user:r,loading:o,isalarcoins:!1}),(0,p.jsx)(ye.default,{style:Ie.nav,children:s.map(((a,t)=>(0,p.jsx)(i.DrawerItem,{icon:({color:e,size:t})=>(0,p.jsx)(F.default,{name:a.icon,color:e,size:t}),label:a.label,onPress:()=>e.navigation.navigate(a.screen)},t)))}),(0,p.jsxs)(ye.default,{style:Ie.bottom,children:[(0,p.jsx)(i.DrawerItem,{icon:({color:e,size:t})=>(0,p.jsx)(F.default,{name:a?"moon":"sunny",color:e,size:t}),label:a?"Modo oscuro":"Modo claro",onPress:t,style:Ie.themeItem,right:()=>(0,p.jsx)(je.default,{value:a,onValueChange:t})}),(0,p.jsx)(i.DrawerItem,{icon:({color:e,size:a})=>(0,p.jsx)(pe.default,{name:"log-out",color:e,size:a}),label:"Cerrar sesi\xf3n",onPress:()=>{l(),c.dispatch(n.CommonActions.reset({index:0,routes:[{name:"Login"}]}))}})]})]})}))}const Ie=S.default.create({container:{flex:1,paddingTop:24},nav:{marginTop:16},bottom:{marginTop:"auto",padding:5},switchRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:8},themeItem:{paddingRight:8}});var Me=t(8112),_e=t(2511),Re=t(2061),Oe=t(5933),We=t(6375),Le=t(3479),Ne=t(5315);const $e=({historial:e,onSeleccionar:a,error:t})=>{const[r,n]=(0,l.useState)(!1),[o,i]=(0,l.useState)({label:"Elegir materia",id:null}),{colors:s}=(0,P.useTheme)(),c=()=>n(!1),d=(e,t)=>{i({label:e,id:t}),c(),a(t)};return(0,l.useEffect)((()=>{i({label:"Elegir materia",id:null})}),[e]),(0,p.jsxs)(C.default,{children:[(0,p.jsxs)(Le.default,{visible:r,onDismiss:c,anchor:(0,p.jsx)(le.default,{mode:t?"contained-tonal":"outlined",onPress:()=>n(!0),contentStyle:Ve.buttonContent,style:[Ve.button,t&&{borderColor:s.error}],children:(0,p.jsxs)(C.default,{style:Ve.labelWithIcon,children:[(0,p.jsx)(F.default,{name:"book-outline",size:18,color:t?s.error:s.onSurface,style:Ve.iconLeft}),(0,p.jsxs)(C.default,{style:Ve.labelTextWrapper,children:[(0,p.jsx)(F.default,{name:r?"chevron-up":"chevron-down",size:18,color:t?s.error:s.onSurface,style:Ve.iconRight}),(0,p.jsx)(C.default,{children:(0,p.jsx)(le.default,{mode:"text",style:Ve.innerLabel,disabled:!0,labelStyle:{color:s.onSurface},children:o.label})})]})]})}),children:[(0,p.jsx)(Le.default.Item,{onPress:()=>d("Elegir materia",null),title:"Elegir materia",leadingIcon:()=>(0,p.jsx)(F.default,{name:"refresh-outline",size:18,color:s.primary})},"default-item"),(0,p.jsx)(Z.default,{}),e.map((e=>(0,p.jsx)(Le.default.Item,{onPress:()=>d(e.nombre,e.aula_id),title:e.nombre,leadingIcon:()=>(0,p.jsx)(F.default,{name:"school-outline",size:18,color:s.primary})},e.aula_id)))]}),t&&(0,p.jsx)(Ne.default,{type:"error",visible:t,children:"Debes seleccionar una materia."})]})},Ve=S.default.create({buttonContent:{flexDirection:"row",justifyContent:"space-between"},button:{borderWidth:1},labelWithIcon:{flexDirection:"row",alignItems:"center"},labelTextWrapper:{flexDirection:"row",alignItems:"center",gap:6},iconLeft:{marginRight:8},iconRight:{marginRight:4},innerLabel:{paddingHorizontal:0}}),Fe=({visible:e,onDismiss:a,user:t,is_teacher:r,selectedAula:n})=>{if(!t)return null;const{colors:o}=(0,P.useTheme)(),[i,s]=(0,l.useState)(r?"asignar":"historial"),[c,d]=(0,l.useState)("0"),[u,f]=(0,l.useState)(""),[m,h]=(0,l.useState)("1"),[g,x]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),[b,w]=(0,l.useState)(""),{alarcoins:S,loadAlarcoins:T}=O(),{token:E}=v(),[B,z]=(0,l.useState)(!1),A=(0,l.useMemo)((()=>t?r?S.map((e=>{const a=e.alumnos.find((e=>e.id===t.id));return a?{aula_id:e.aula_id,nombre:e.nombre,alarcoins:a.alarcoins||[]}:null})).filter((e=>null!==e)):n?[{aula_id:n.id,nombre:n.nombre,alarcoins:n.alarcoins}]:[]:[]),[S,t,r,n]);return(0,p.jsxs)(Me.default,{children:[(0,p.jsx)(_e.default,{visible:y&&""!==b,duration:1e3,onDismiss:()=>{j(!1),w("")},action:{label:"Dale",onPress:()=>j(!1)},children:b}),(0,p.jsxs)(Re.default,{visible:e,onDismiss:a,contentContainerStyle:{backgroundColor:o.surface,padding:10,margin:10,borderRadius:12,width:"90%",maxWidth:500,justifyContent:"flex-start",alignSelf:"center"},children:[(0,p.jsx)(C.default,{style:{flexDirection:"row",justifyContent:"center",alignItems:"center",width:"100%",flexWrap:"nowrap",overflow:"hidden",marginBottom:8},children:(0,p.jsx)(Oe.default,{value:i,onValueChange:s,buttons:[{value:"historial",label:"Historial"},...r?[{value:"asignar",label:"Asignar"}]:[]],style:{flex:1,minWidth:0,maxWidth:"100%",borderRadius:12,overflow:"hidden"},contentStyle:{flexDirection:"row",flexWrap:"nowrap",minWidth:0,maxWidth:"100%"}})}),"asignar"===i&&r&&(0,p.jsxs)($.default,{mode:"contained",style:{marginTop:10,padding:5},children:[(0,p.jsx)(L.default,{variant:"titleMedium",style:{marginBottom:5},children:`Gestionar Alarcoins de: ${t.nombre} ${t.apellido}`}),(0,p.jsx)($e,{historial:A,onSeleccionar:x}),(0,p.jsx)(Z.default,{style:{marginVertical:16}}),(0,p.jsx)(L.default,{variant:"labelLarge",style:{marginBottom:4},children:"Cantidad"}),(0,p.jsxs)(C.default,{style:{flexDirection:"row",alignItems:"center",gap:8},children:[(0,p.jsx)(le.default,{mode:"outlined",onPress:()=>d((e=>String(Math.max(0,Number(e)-1)))),children:"-"}),(0,p.jsx)(fe.default,{value:c,onChangeText:d,keyboardType:"numeric",mode:"outlined",style:{flex:1}}),(0,p.jsx)(le.default,{mode:"outlined",onPress:()=>d((e=>String(Number(e)+1))),children:"+"})]}),(0,p.jsx)(fe.default,{label:"Concepto",mode:"outlined",value:u,onChangeText:f,style:{marginTop:16}}),(0,p.jsx)(L.default,{variant:"labelLarge",style:{marginTop:16},children:"Tipo de operaci\xf3n"}),(0,p.jsx)(We.default.Group,{onValueChange:e=>h(e),value:m,children:(0,p.jsxs)(C.default,{style:{flexDirection:"row",justifyContent:"flex-end"},children:[(0,p.jsx)(We.default.Item,{label:"Sumar",value:"1"}),(0,p.jsx)(We.default.Item,{label:"Restar",value:"0"})]})}),(0,p.jsx)(Z.default,{style:{marginVertical:16}}),(0,p.jsx)(C.default,{style:{flexDirection:"row",justifyContent:"flex-end"},children:(0,p.jsx)(le.default,{mode:"contained",onPress:async()=>{if(!g||0===g)return w("Debes seleccionar una materia v\xe1lida."),void j(!0);if(!u.trim())return void ue.default.alert("Atenci\xf3n","Debes ingresar un concepto.");z(!0);const e={aula_id:g,alumno_id:t.id,detalle:u,suma:Number(m),cantidad:Number(c)};try{await async function(e,a){const t=await fetch(`${M}/alarcoins/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al asignar alarcoin")}return await t.json()}(E,e),d("0"),f(""),h("true"),x(null),a(),T(),w("Alarcoin guardado correctamente."),j(!0)}catch(r){w("error al guardar"),j(!0)}finally{z(!1)}},children:B?"Guardando...":"Guardar"})})]}),"historial"===i&&(0,p.jsxs)(C.default,{style:{marginTop:12},children:[(0,p.jsx)(L.default,{variant:"titleMedium",style:{marginBottom:8},children:"Historial de Alarcoins"}),A.every((e=>0===e.alarcoins.length))?(0,p.jsx)(L.default,{style:{marginTop:8},children:"No hay historial a\xfan"}):(0,p.jsx)(k.default,{children:A.filter((e=>e.alarcoins.length>0)).map((e=>{const a=e.alarcoins.reduce(((e,a)=>e+(a.suma>0?a.cantidad:-a.cantidad)),0);return(0,p.jsxs)($.default,{style:{marginBottom:16},children:[(0,p.jsx)($.default.Title,{title:(0,p.jsxs)(C.default,{style:{flexDirection:"row",alignItems:"center"},children:[(0,p.jsx)(L.default,{children:e.nombre}),(0,p.jsx)(L.default,{style:{marginLeft:8,fontWeight:"bold",color:a>=0?"green":"red"},children:`(${a})`})]},e.aula_id)}),(0,p.jsx)($.default.Content,{children:e.alarcoins.map((e=>(0,p.jsxs)(C.default,{children:[(0,p.jsxs)(C.default,{style:{flexDirection:"row",justifyContent:"space-between",marginVertical:4},children:[(0,p.jsx)(L.default,{children:new Date(e.fecha).toLocaleDateString()}),(0,p.jsx)(L.default,{children:e.detalle}),(0,p.jsx)(L.default,{style:{color:e.suma>0?"green":"red"},children:e.suma>0?`+${e.cantidad}`:`-${e.cantidad}`})]},e.id),(0,p.jsx)(Z.default,{})]},e.id)))})]},e.aula_id)}))})]})]})]})};var Ge=t(4250);function He({isLoading:e,hasError:a,reLoad:r,children:n,errorMessage:o="Ocurri\xf3 un error al cargar los datos"}){return e?(0,p.jsx)(C.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:(0,p.jsx)(W.default,{size:"large",color:"violet"})}):a?(0,p.jsxs)(C.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:[(0,p.jsx)(L.default,{variant:"titleLarge",style:{marginBottom:12,color:"#9333EA",textAlign:"center"},children:o}),(0,p.jsx)(Ge.default,{source:t(2058),style:{width:200,height:200,marginBottom:20,borderRadius:100},resizeMode:"contain"}),(0,p.jsx)(le.default,{mode:"contained",onPress:r,children:"Reintentar"})]}):(0,p.jsx)(p.Fragment,{children:n})}function Je({materia:e,onPress:a,porcentaje:t=0,is_alumno:r,alarcoin:n}){const{colors:o}=(0,P.useTheme)();console.log(t);return(0,p.jsx)($.default,{style:[qe.card],mode:"outlined",onPress:a?()=>a(e):void 0,children:(0,p.jsx)(A.LinearGradient,{colors:r&&!n?(e=>0===e?["transparent","transparent"]:e<60?[o.background,o.asistenciaMala]:e<79?[o.background,o.asistenciaMedia]:[o.background,o.asistenciaBuena])(t):["#trnasparent","transparent"],start:{x:.4,y:.3},end:{x:1,y:1},style:{borderRadius:8,padding:10},children:(0,p.jsxs)($.default.Content,{style:qe.cardContent,children:[(0,p.jsxs)(C.default,{style:qe.infoLeft,children:[(0,p.jsx)(L.default,{variant:"titleMedium",children:e.nombre}),(0,p.jsx)(C.default,{style:qe.scheduleRow,children:(0,p.jsx)(L.default,{variant:"bodySmall",children:`${e.ano}\xb0 ${e.division}\xb0 - ${e.especialidad}`})})]}),(0,p.jsxs)(C.default,{style:qe.infoRight,children:[(0,p.jsx)(L.default,{variant:"labelSmall",children:r&&null==n?"Asistencias":null!=n?"Alarcoins":" Clases dictadas"}),(0,p.jsx)(L.default,{variant:"titleMedium",style:qe.classCount,children:r&&null==n?`${t}%`:null!=n?n:e.cantidad_clases})]})]})})})}const qe=S.default.create({card:{marginBottom:16,width:"100%",marginHorizontal:10,maxWidth:450,borderRadius:8,elevation:3,alignSelf:"center"},cardContent:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},infoLeft:{flex:1,gap:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},infoRight:{alignItems:"flex-end"},classCount:{marginTop:2,fontWeight:"600"}});var Ue=t(5539);function Ke({items:e,renderItem:a,getKey:t,numColumns:r,refreshing:n,onRefresh:o,ListEmptyComponent:i,ListFooterComponent:l,alumno:s}){const{width:c}=(0,T.default)(),d=!0===s?1:r||(c>=900?2:1);return(0,p.jsx)(Ue.default,{data:e,keyExtractor:e=>t(e).toString(),numColumns:d,refreshing:n,onRefresh:o,contentContainerStyle:{padding:12,gap:12,paddingBottom:32},columnWrapperStyle:d>1?{gap:12,justifyContent:"space-between",marginBottom:12}:void 0,renderItem:({item:e})=>(0,p.jsx)(C.default,{style:{flex:1,marginBottom:12},children:a(e)}),ListEmptyComponent:i,ListFooterComponent:l},d)}const Ze=()=>{const{user:e}=v(),{alumnosMap:a,loadAlarcoins:t,alarcoins:r,alarcoinsError:n,aulas:o}=O(),[i,s]=(0,l.useState)(null),[c,d]=(0,l.useState)(),[u,f]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!0),[y,j]=(0,l.useState)(null),{width:b}=(0,T.default)(),w=(0,l.useMemo)((()=>b>=1e3?3:b>=600?2:1),[b]),S=async()=>{h(!0);try{if(e?.is_teacher){const e=await g();if(e&&Array.isArray(e))return void j(e)}else{const e=await x();if(e&&Array.isArray(e))return void j(e)}t(),j(r)}catch(a){console.error("Error al cargar alarcoins:",a)}finally{h(!1)}};(0,l.useEffect)((()=>{S()}),[]);const k=a=>{e?.is_teacher?s(a):(s(e),d(a)),f(!0)},E=e?.is_teacher?Object.values(a):y??[];return(0,p.jsx)(D,{children:(0,p.jsxs)(He,{isLoading:m,hasError:n,errorMessage:"Error al cargar los Alarcoins",reLoad:S,children:[(0,p.jsxs)(C.default,{style:{flexDirection:"row",justifyContent:"space-between"},children:[(0,p.jsx)(L.default,{variant:"titleMedium",children:e?.is_teacher?"Tus Alumnos":"Alarcoin por aulas"}),(0,p.jsx)(C.default,{style:{marginBottom:10,width:200},children:(0,p.jsx)(le.default,{mode:"contained",style:{borderRadius:8,marginVertical:10},onPress:t,icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"refresh",color:e,size:a}),children:"Refrescar"})})]}),(0,p.jsx)(Ke,{items:E,numColumns:w,renderItem:a=>{if(e?.is_teacher)return(0,p.jsx)(xe.default,{style:({pressed:e})=>[{flex:1,opacity:e?.5:1}],onPress:()=>k(a),children:(0,p.jsx)(ve,{user:a,loading:!1,isalarcoins:!0,alarcoins:a.alarcoin})});{const e=o.find((e=>e.id===a.aula_id));if(!e)return null;const t=a.alarcoins.reduce(((e,a)=>e+(a.suma?a.cantidad:-a.cantidad)),0);return(0,p.jsx)(xe.default,{style:({pressed:e})=>[{flex:1,opacity:e?.5:1}],onPress:()=>k(a),children:(0,p.jsx)(Je,{materia:e,is_alumno:!0,alarcoin:t})})}},getKey:a=>e?.is_teacher?a.id:a.nombre,refreshing:m,onRefresh:S,alumno:!e?.is_teacher}),(0,p.jsx)(Fe,{visible:u,onDismiss:()=>{f(!1)},user:i,is_teacher:e?.is_teacher,selectedAula:c})]})})};const Qe=()=>{const{user:e,setUser:a,token:t}=v(),r=(0,n.useNavigation)(),[o,i]=(0,l.useState)(!1),[s,d]=(0,l.useState)(null),[f,m]=(0,l.useState)(t);(0,l.useEffect)((()=>{if(f)return;const e=u("token");m(e)}));const h=ie.object().shape({newPassword:ie.string().min(6,"La contrase\xf1a debe tener al menos 6 caracteres").matches(/[A-Z]/,"La contrase\xf1a debe contener al menos una letra may\xfascula").required("Campo obligatorio"),confirmPassword:ie.string().oneOf([ie.ref("newPassword")],"Las contrase\xf1as no coinciden").required("Campo obligatorio")});return(0,p.jsx)(D,{children:(0,p.jsx)(C.default,{style:Xe.container,children:(0,p.jsxs)($.default,{style:Xe.card,children:[(0,p.jsx)($.default.Title,{title:"Cambia tu contrase\xf1a",subtitle:"Por seguridad, debes actualizarla"}),(0,p.jsx)($.default.Content,{children:(0,p.jsx)(oe.Formik,{initialValues:{newPassword:"",confirmPassword:""},validationSchema:h,onSubmit:async e=>{i(!0),d(null);try{const n=await async function(e,a){const t=await fetch(`${M}/users/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al actualizar el usuario")}return await t.json()}({password:e.newPassword,cambiarContrasena:!1},t);a(Object.assign({},n)),await c(n),r.navigate("Main")}catch(n){d(n.message||"Error al cambiar la contrase\xf1a")}finally{i(!1)}},children:({handleChange:e,handleBlur:a,handleSubmit:t,values:r,errors:n,touched:i})=>(0,p.jsxs)(C.default,{children:[(0,p.jsx)(fe.default,{label:"Nueva contrase\xf1a",secureTextEntry:!0,value:r.newPassword,onChangeText:e("newPassword"),onBlur:a("newPassword"),style:Xe.input}),i.newPassword&&n.newPassword&&(0,p.jsx)(L.default,{style:Xe.error,children:n.newPassword}),(0,p.jsx)(fe.default,{label:"Repetir contrase\xf1a",secureTextEntry:!0,value:r.confirmPassword,onChangeText:e("confirmPassword"),onBlur:a("confirmPassword"),style:Xe.input}),i.confirmPassword&&n.confirmPassword&&(0,p.jsx)(L.default,{style:Xe.error,children:n.confirmPassword}),s&&(0,p.jsx)(L.default,{style:Xe.error,children:s}),(0,p.jsx)(le.default,{mode:"contained",onPress:t,style:Xe.button,disabled:o,loading:o,children:"Guardar contrase\xf1a"})]})})})]})})})},Xe=S.default.create({container:{flex:1,width:"100%",alignItems:"center",padding:20,justifyContent:"center"},card:{width:"100%",maxWidth:600},input:{marginBottom:10},button:{marginTop:10},error:{color:"red",marginBottom:10}});const Ye=()=>{const{width:e}=(0,T.default)(),a=e>=900?2:1,{user:t,token:r}=v(),o=(0,n.useNavigation)(),{aulas:i}=O(),[c,d]=(0,l.useState)(!0),[u,f]=(0,l.useState)([]),m=async()=>{d(!0);try{const e=await async function(e){const a=await fetch(`${M}/asistencias/mis-asistencias`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const e=await a.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await a.json()}(r);f(e),await(async e=>{try{await s.default.setItem("asistencias",JSON.stringify(e))}catch(a){console.error("Error al guardar asistencias:",a)}})(e)}catch(e){console.error("Error recargando asistencias",e)}finally{d(!1)}};(0,l.useEffect)((()=>{t?.is_teacher||(async()=>{d(!0);const e=await(async()=>{try{const e=await s.default.getItem("asistencias");return e?JSON.parse(e):null}catch(e){return console.error("Error al leer asistencias:",e),null}})();if(e)return f(e),void d(!1);m()})()}),[c]);return(0,p.jsxs)(D,{children:[(0,p.jsxs)(C.default,{style:ea.header,children:[(0,p.jsxs)(C.default,{children:[(0,p.jsx)(L.default,{variant:"titleLarge",style:ea.title,children:"Mis Materias"}),(0,p.jsx)(L.default,{variant:"bodyMedium",style:ea.subtitle,children:t?.is_teacher?"Lista de materias que dictas":"Lista de materias que cursas"})]}),(0,p.jsx)(le.default,{mode:"contained",style:ea.button,onPress:m,icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"refresh",color:e,size:a}),children:"Refrescar"})]}),(0,p.jsx)(k.default,{contentContainerStyle:{paddingBottom:32,gap:12,flexDirection:a>1?"row":"column",flexWrap:a>1?"wrap":"nowrap",justifyContent:a>1?"center":"flex-start"},children:i.map((r=>{const n=u.find((e=>e.aula_id===r.id)),i=n?.porcentaje_asistencia,l=u.find((e=>e.aula_id===r.id)),s=l?.asistencias||[];return(0,p.jsx)(C.default,{style:[ea.card,a>1&&{width:e/2-24,marginHorizontal:6}],children:(0,p.jsx)(Je,{materia:r,onPress:()=>((e,a)=>{o.navigate("MateriasStack",{screen:"DetalleMateria",params:{materia:e,asistencia:a}})})(r,s),porcentaje:i,is_alumno:!t?.is_teacher,alarcoin:void 0})},r.id)}))})]})},ea=S.default.create({container:{padding:16,justifyContent:"center",alignItems:"center"},header:{marginBottom:24,flexDirection:"row",justifyContent:"space-between",alignContent:"center"},title:{fontWeight:"bold"},subtitle:{marginTop:4,color:"#6b7280"},card:{marginBottom:16},cardContent:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start"},infoLeft:{flex:1,gap:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},scheduleText:{color:"#6b7280"},infoRight:{alignItems:"flex-end"},label:{color:"#6b7280"},classCount:{marginTop:2,fontWeight:"600"},button:{borderRadius:8,marginVertical:10}});function aa({visible:e,onClose:a,clase:t}){const{token:r}=v(),{alumnosMap:n,aulas:o}=O(),[i,s]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[u,f]=(0,l.useState)([]),{colors:m}=(0,P.useTheme)(),{width:h}=(0,T.default)(),g=h<600,x=h>=1e3?3:h>=700?2:1,y=o.find((e=>e.id===t.aula_id)),j=y?.alumnoIds.map((e=>n[e])).filter(Boolean)??[];(0,l.useEffect)((()=>{if(!e)return;d(!0);(async()=>{try{const e=await async function(e,a){const t=await fetch(`${M}/asistencias/asistencias-por-clase/${e}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(t.id,r);if(s(e),0===e.length){const e=j.map((e=>({alumno_id:e.id,presente:1})));f(e)}}catch(e){console.error("Error al obtener asistencias:",e)}finally{d(!1)}})(),f([])}),[e,t.id]),(0,l.useEffect)((()=>{e||(s([]),f([]))}),[e]);const b=(e,a)=>{f((t=>t.find((a=>a.alumno_id===e))?t.map((t=>t.alumno_id===e?Object.assign({},t,{presente:a}):t)):[...t,{alumno_id:e,presente:a}]))};return(0,p.jsx)(Me.default,{children:(0,p.jsxs)(Re.default,{visible:e,onDismiss:a,contentContainerStyle:[ta.modalContainer,{backgroundColor:m.background}],children:[(0,p.jsxs)(L.default,{variant:"titleMedium",style:ta.headerTitle,children:["Asistencia - ",t.tema]}),c?(0,p.jsx)(W.default,{style:{marginVertical:20}}):(0,p.jsx)(k.default,{contentContainerStyle:ta.scroll,children:(0,p.jsx)(C.default,{style:[ta.grid,{gap:12}],children:j.map((e=>{const a=i.find((a=>a.alumno_id===e.id)),t=u.find((a=>a.alumno_id===e.id)),r=t?.presente?.toString()??a?.presente?.toString()??"",n=t?.justificado??a?.justificado??"";return(0,p.jsx)(C.default,{style:[ta.cardWrapper,{width:100/x-4+"%"}],children:(0,p.jsx)($.default,{mode:"outlined",style:ta.alumnoCard,children:(0,p.jsxs)($.default.Content,{style:{gap:4,padding:5},children:[(0,p.jsxs)(L.default,{style:ta.nombreAlumno,children:[e.nombre," ",e.apellido]}),(0,p.jsx)(We.default.Group,{onValueChange:a=>b(e.id,parseInt(a)),value:r,children:(0,p.jsx)(C.default,{style:ta.radioRowFixed,children:[{label:g?"P":"Presente",value:"1"},{label:g?"A":"Ausente",value:"2"},{label:g?"T":"Tarde",value:"3"},{label:"NC",value:"0"}].map((a=>(0,p.jsxs)(xe.default,{style:ta.radioItemPressable,onPress:()=>b(e.id,parseInt(a.value)),children:[(0,p.jsx)(We.default,{value:a.value,status:r===a.value?"checked":"unchecked",onPress:()=>b(e.id,parseInt(a.value))}),(0,p.jsx)(L.default,{style:[g?ta.radioLabelMobile:ta.radioLabel,ta.radioLabelText],children:a.label})]},a.value)))})}),(0,p.jsx)(fe.default,{label:"Justificaci\xf3n",mode:"outlined",value:n,onChangeText:a=>{return t=e.id,r=a,void f((e=>e.find((e=>e.alumno_id===t))?e.map((e=>e.alumno_id===t?Object.assign({},e,{justificado:r}):e)):[...e,{alumno_id:t,presente:2,justificado:r}]));var t,r}})]})})},e.id)}))})}),(0,p.jsxs)(C.default,{style:ta.buttonRow,children:[(0,p.jsx)(le.default,{mode:"text",onPress:a,children:"Cancelar"}),(0,p.jsx)(le.default,{mode:"contained",onPress:async()=>{try{if(0===u.length)return void ue.default.alert("Sin cambios","No se detectaron asistencias editadas.");const e=j.map((e=>{const a=u.find((a=>a.alumno_id===e.id));return{alumno_id:e.id,presente:a?.presente??1,justificado:a?.justificado??"no"}}));console.log("Payload a enviar:",e),await async function(e,a,t){console.log(t);const r=await fetch(`${M}/asistencias/masiva/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!r.ok){const e=await r.json();throw new Error(e.detail||"Error al guardar asistencias")}}(t.id,r,e),ue.default.alert("Guardado","Las asistencias fueron actualizadas correctamente."),f([]),a()}catch(e){console.error("Error al guardar asistencias:",e),ue.default.alert("Error",e.message||"Ocurri\xf3 un error al guardar.")}},children:"Guardar"})]})]})})}const ta=S.default.create({modalContainer:{margin:10,padding:20,borderRadius:12,maxHeight:"95%"},scroll:{paddingVertical:5},headerTitle:{marginBottom:12},grid:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"},cardWrapper:{marginBottom:16},alumnoCard:{borderRadius:12},nombreAlumno:{fontWeight:"600",marginBottom:4},radioRow:{flexDirection:"row",justifyContent:"space-evenly"},buttonRow:{flexDirection:"row",justifyContent:"flex-end",marginTop:20,gap:10},radioRowFixed:{flexDirection:"row",justifyContent:"space-evenly",alignItems:"center",flexWrap:"nowrap"},radioItemFixed:{flex:1,margin:0,padding:0},radioLabel:{fontSize:14},radioLabelMobile:{fontSize:12},radioItemPressable:{flex:1,alignItems:"center",justifyContent:"center",flexDirection:"column",minWidth:50,maxWidth:80},radioLabelText:{textAlign:"center",flexShrink:1}});function ra({clase:e,asistencia:a}){const[t,r]=(0,l.useState)(!1),{user:n}=v(),{colors:o}=(0,P.useTheme)();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)($.default,{style:[na.card],children:(0,p.jsx)(A.LinearGradient,{colors:n?.is_teacher?["#trnasparent","transparent"]:(e=>1===e?[o.background,o.asistenciaBuena]:2===e?[o.background,o.asistenciaMala]:3===e?[o.background,o.asistenciaMedia]:["transparent","transparent"])(a?.presente),start:{x:.4,y:.3},end:{x:1,y:1},style:{borderRadius:8,padding:10},children:(0,p.jsxs)($.default.Content,{children:[(0,p.jsxs)(C.default,{style:na.headerRow,children:[(0,p.jsx)(L.default,{variant:"titleSmall",style:na.cardTitle,children:e.tema}),(0,p.jsx)(C.default,{style:na.iconButtons,children:n?.is_teacher?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(F.default,{name:"create-outline",size:20,color:"#9CA3AF",style:na.iconMargin}),(0,p.jsx)(F.default,{name:"trash-outline",size:20,color:"#9CA3AF"})]}):(0,p.jsxs)(L.default,{variant:"bodyMedium",children:[" ",a?1===a.presente?"Presente":2===a.presente?"Ausente":"Tarde":"Sin asistencia"]})})]}),(0,p.jsxs)(C.default,{style:na.scheduleRow,children:[(0,p.jsx)(F.default,{name:"calendar-outline",size:13,color:"#9CA3AF",style:na.iconMargin}),(0,p.jsx)(L.default,{variant:"bodySmall",style:na.cardSubtitle,children:e.fecha.toString()})]}),n?.is_teacher&&(0,p.jsx)(le.default,{mode:"outlined",icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"checkmark-circle",color:e,size:a}),style:na.attendanceButton,onPress:()=>r(!0),children:"Tomar asistencia"})]})})}),(0,p.jsx)(aa,{visible:t,onClose:()=>r(!1),clase:e})]})}const na=S.default.create({card:{width:"100%",maxWidth:400,borderRadius:8,elevation:2,alignSelf:"center",marginHorizontal:15,marginBottom:10},headerRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},iconButtons:{flexDirection:"row"},iconMargin:{marginRight:8},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4},cardTitle:{fontWeight:"bold",marginBottom:4},cardSubtitle:{color:"#6B7280"},attendanceButton:{marginTop:10},modalBackdrop:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center"},modalContainer:{width:"85%",padding:20,backgroundColor:"white",borderRadius:10,elevation:5},modalCloseButton:{marginTop:20,alignSelf:"flex-end"},modalCloseText:{color:"#2563EB",fontWeight:"bold"}});function oa(){const{width:e}=(0,T.default)(),a=(0,n.useRoute)(),{materia:r,asistencia:o}=a.params,i=(0,n.useNavigation)(),{token:s,user:c}=v(),[d,f]=(0,l.useState)(!0),[m,h]=(0,l.useState)([]),[g,x]=(0,l.useState)(!1),{colors:b}=(0,P.useTheme)(),w=async(e=!1)=>{let a=s;s||(a=await u("token"));try{if(!e){const e=await j(r.id);if(e)return h(e),void f(!1)}const t=await async function(e,a){const t=await fetch(`${M}/clases/aulas/${e}/clases`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Error al iniciar sesi\xf3n")}return await t.json()}(r.id,a);h(t),await y(r.id,t)}catch(g){console.log("error al obtener las clases",g),x(!0)}finally{f(!1)}},S=c?.is_teacher?m:m.filter((e=>!/^clases\s+\d+/i.test(e.tema))),E=e>=1024?3:e>=600?2:1,B=e<600;(0,l.useEffect)((()=>{w()}),[]);const z=()=>{};return(0,p.jsx)(D,{children:(0,p.jsxs)(C.default,{style:ia.container,children:[(0,p.jsxs)(C.default,{style:[ia.sectionHeader,B&&{flexDirection:"column",alignItems:"flex-start",gap:8}],children:[(0,p.jsxs)(C.default,{style:[ia.headerRow,B&&{flexDirection:"row",alignItems:"center"}],children:[(0,p.jsx)(le.default,{onPress:()=>{i.goBack()},mode:"text",compact:!0,icon:({size:e,color:a})=>(0,p.jsx)(F.default,{name:"arrow-back",size:16,color:b.primary}),contentStyle:ia.backButton,labelStyle:[ia.backButtonText,B&&{display:"none"}],children:!B&&"Volver"}),(0,p.jsx)(L.default,{variant:B?"titleSmall":"titleMedium",style:[ia.subjectTitle,{flexShrink:1,flexWrap:"wrap",maxWidth:B?"90%":"100%"}],numberOfLines:1,ellipsizeMode:"tail",children:r.nombre})]}),(0,p.jsxs)(C.default,{style:ia.scheduleRow,children:[(0,p.jsx)(le.default,{mode:"contained",style:ia.addButton,onPress:()=>w(!0),icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"refresh",color:e,size:a}),children:"Refrescar"}),c?.is_teacher&&(0,p.jsx)(le.default,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"add-circle-outline",color:e,size:a}),mode:"contained",onPress:z,contentStyle:ia.addButtonContent,style:ia.addButton,children:"Agregar Clase"})]})]}),d?(0,p.jsx)(W.default,{size:"large",color:"violet"}):g?(0,p.jsxs)(C.default,{style:{alignItems:"center",justifyContent:"center",flex:1},children:[(0,p.jsx)(L.default,{variant:"titleLarge",style:{marginBottom:12,color:"#9333EA",textAlign:"center"},children:"Ocurri\xf3 un error al cargar las clases"}),(0,p.jsx)(Ge.default,{source:t(2058),style:{width:180,height:180,marginBottom:20,borderRadius:90,opacity:.85},resizeMode:"contain"}),(0,p.jsx)(le.default,{mode:"contained",onPress:()=>{f(!0),x(!1),w()},style:{marginTop:8},children:"Reintentar"})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(k.default,{contentContainerStyle:{paddingBottom:c?.is_teacher?90:32,paddingHorizontal:6,gap:10},showsVerticalScrollIndicator:!1,children:0===S.length?(0,p.jsxs)(C.default,{children:[(0,p.jsx)(F.default,{name:"information-circle-outline",size:48,color:"#A78BFA"}),(0,p.jsx)(L.default,{style:{color:"#6B7280",marginTop:12,textAlign:"center"},children:"No hay clases registradas a\xfan."})]}):((e,a)=>{const t=[];for(let r=0;r<e.length;r+=a)t.push(e.slice(r,r+a));return t})(S,E).map(((e,a)=>(0,p.jsxs)(C.default,{style:{flexDirection:"row",justifyContent:E>1?"center":"flex-start",marginBottom:10,gap:10},children:[e.map((e=>{const a=o.find((a=>a.id===e.id));return(0,p.jsx)(C.default,{style:{flex:1,maxWidth:100/E+"%"},children:(0,p.jsx)(C.default,{children:(0,p.jsx)(ra,{clase:e,asistencia:a})})},e.id)})),e.length<E&&Array.from({length:E-e.length}).map(((e,a)=>(0,p.jsx)(C.default,{style:{flex:1,maxWidth:100/E+"%",minHeight:120}},`empty-${a}`)))]},a)))}),c?.is_teacher&&(0,p.jsx)(C.default,{children:(0,p.jsx)(le.default,{icon:({color:e,size:a})=>(0,p.jsx)(F.default,{name:"add-circle",color:e,size:a}),mode:"contained",onPress:z,contentStyle:ia.addButtonContent,style:ia.addButton,labelStyle:{fontWeight:"bold",fontSize:16},children:"Agregar Clase"})})]})]})})}const ia=S.default.create({container:{flex:1,padding:10},backButton:{flexDirection:"row",alignItems:"center",paddingLeft:0},backButtonText:{color:"#4B5563",fontSize:14,marginLeft:4},scheduleRow:{flexDirection:"row",alignItems:"center",marginTop:4,gap:6},subjectTitle:{fontWeight:"bold"},subjectSchedule:{color:"#6B7280",marginTop:4,marginBottom:4},sectionHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginVertical:8},addButton:{borderRadius:8,marginVertical:10},addButtonContent:{flexDirection:"row"},headerRow:{flexDirection:"row",alignItems:"center",gap:8}}),la=(0,o.createNativeStackNavigator)();function sa(){return(0,p.jsxs)(la.Navigator,{screenOptions:{headerShown:!1},children:[(0,p.jsx)(la.Screen,{name:"Materias",component:Ye,options:{title:"adminAulas | Mis Materias"}}),(0,p.jsx)(la.Screen,{name:"DetalleMateria",component:oa,options:{title:"adminAulas | Detalle de Materia"}})]})}const ca=(0,o.createNativeStackNavigator)(),da=(0,i.createDrawerNavigator)();function ua(){const{colors:e}=(0,P.useTheme)(),{user:a}=v(),t=(0,l.useMemo)((()=>a),[a]);return(0,p.jsxs)(da.Navigator,{drawerContent:e=>(0,p.jsx)(De,Object.assign({},e)),screenOptions:({navigation:a})=>({headerStyle:{backgroundColor:e.elevation.level2},headerTintColor:e.primary,headerTitleStyle:{fontWeight:"bold"},headerRight:()=>(0,p.jsx)(C.default,{style:{padding:2},children:(0,p.jsx)(xe.default,{onPress:()=>a.navigate("Perfil"),style:{},children:(0,p.jsx)(K.default,{label:be(t?.nombre,t?.apellido),size:40,style:{backgroundColor:e.primary,width:40,height:40,marginRight:10}})})})}),children:[(0,p.jsx)(da.Screen,{name:"Home",component:ee,options:{title:"adminAulas | Dashboard"}}),(0,p.jsx)(da.Screen,{name:"MateriasStack",component:sa,options:{title:"adminAulas | Mis Materias"}}),(0,p.jsx)(da.Screen,{name:"Perfil",component:ge,options:{title:"adminAulas | Mi Perfil"}}),(0,p.jsx)(da.Screen,{name:"Alarcoin",component:Ze,options:{title:"adminAulas | Mis Alarcoin"}})]})}const fa=()=>{const{user:e}=v(),{theme:a}=Pe(),t=a.dark?Object.assign({},n.DarkTheme,{colors:Object.assign({},n.DarkTheme.colors,a.colors)}):Object.assign({},n.DefaultTheme,{colors:Object.assign({},n.DefaultTheme.colors,a.colors)});return(0,p.jsx)(n.NavigationContainer,{theme:t,children:(0,p.jsx)(ca.Navigator,{children:e?e.cambiarContrasena?(0,p.jsx)(ca.Screen,{name:"CambiarContra",component:Qe,options:{title:"adminAulas | Cambiar Contrase\xf1a",headerShown:!1}}):(0,p.jsx)(ca.Screen,{name:"Main",component:ua,options:{headerShown:!1}}):(0,p.jsx)(ca.Screen,{name:"Login",component:ce,options:{headerShown:!1}})})})};function ma(){return(0,p.jsx)(w,{children:(0,p.jsx)(R,{children:(0,p.jsx)(fa,{})})})}var ha=t(4465),ga=t(9836),xa=t(1667),ya=t(2059),ja=t(535);const pa=({onFinish:e})=>{const{colors:a}=(0,P.useTheme)(),t=new ja.default.Value(0);return(0,l.useEffect)((()=>{ja.default.timing(t,{toValue:1,duration:1e3,useNativeDriver:!0}).start((()=>{setTimeout((()=>{ja.default.timing(t,{toValue:.5,duration:500,useNativeDriver:!0}).start((()=>{e()}))}),1e3)}))}),[]),(0,p.jsx)(ja.default.View,{style:[ba.container,{opacity:t},{backgroundColor:N}],children:(0,p.jsx)(L.default,{variant:"titleLarge",style:ba.title,children:"AdminAulas \ud83d\ude80"})})},ba=S.default.create({container:{flex:1,justifyContent:"center",alignItems:"center"},title:{fontSize:32,fontWeight:"bold"}});function wa(){const{theme:e,isDarkMode:a}=Pe();return(0,p.jsxs)(ha.default,{theme:e,children:[(0,p.jsx)(ga.StatusBar,{style:a?"light":"dark"}),(0,p.jsx)(ma,{})]})}ya.preventAutoHideAsync(),(0,r.default)((function(){const[e]=(0,xa.useFonts)(Object.assign({},Q.default.font)),[a,t]=(0,l.useState)(!0),r=(0,l.useCallback)((async()=>{}),[e]);return(0,l.useEffect)((()=>{e&&r()}),[e]),e?(0,p.jsx)(Ae,{children:a?(0,p.jsx)(pa,{onFinish:async()=>{t(!1),await ya.hideAsync()}}):(0,p.jsx)(wa,{})}):null}))},2058:(e,a,t)=>{e.exports=t.p+"static/media/errorImagen.a23f855f5c97c01c10ea.png"}},a={};function t(r){var n=a[r];if(void 0!==n)return n.exports;var o=a[r]={exports:{}};return e[r].call(o.exports,o,o.exports,t),o.exports}t.m=e,(()=>{var e=[];t.O=(a,r,n,o)=>{if(!r){var i=1/0;for(d=0;d<e.length;d++){for(var[r,n,o]=e[d],l=!0,s=0;s<r.length;s++)(!1&o||i>=o)&&Object.keys(t.O).every((e=>t.O[e](r[s])))?r.splice(s--,1):(l=!1,o<i&&(i=o));if(l){e.splice(d--,1);var c=n();void 0!==c&&(a=c)}}return a}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,n,o]}})(),t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a:a}),a},t.d=(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.p="/",(()=>{var e={792:0};t.O.j=a=>0===e[a];var a=(a,r)=>{var n,o,[i,l,s]=r,c=0;if(i.some((a=>0!==e[a]))){for(n in l)t.o(l,n)&&(t.m[n]=l[n]);if(s)var d=s(t)}for(a&&a(r);c<i.length;c++)o=i[c],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(d)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(a.bind(null,0)),r.push=a.bind(null,r.push.bind(r))})();var r=t.O(void 0,[404],(()=>t(776)));r=t.O(r)})();
//# sourceMappingURL=main.e6ced901.js.map